[
    {
        "id": "96b3a7bdffc02a46",
        "type": "tab",
        "label": "Предметы",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d0d8641abf4dd3c2",
        "type": "tab",
        "label": "Авторизация",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8cd62b9679ad11ce",
        "type": "tab",
        "label": "Чаты",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5ca377efdfba60c4",
        "type": "tab",
        "label": "Главная/Профиль",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b8ad15e59845239e",
        "type": "tab",
        "label": "Расписание",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b83cceb90218bb16",
        "type": "group",
        "z": "96b3a7bdffc02a46",
        "name": "Внешний вид",
        "style": {
            "label": true
        },
        "nodes": [
            "eb6104075409be7d",
            "3043fb2166b3eba3",
            "6ad66adbfcccd7fe",
            "db4560c7c2073a98",
            "a63363f6d6ed75e1",
            "91d0af505d16a7c3"
        ],
        "x": 54,
        "y": 59,
        "w": 1312,
        "h": 162
    },
    {
        "id": "a18ab01cd2004dcd",
        "type": "group",
        "z": "96b3a7bdffc02a46",
        "name": "Данные",
        "style": {
            "label": true
        },
        "nodes": [
            "acc184a576fc1127",
            "e94ef20631abe1fc",
            "eed8cf825b35c359",
            "0c36d0543db77def",
            "6bd9fdcda1dda3e7",
            "a2b7d415a98b5d0f",
            "43c91f459a58a328",
            "9aa00395d33b40c5",
            "9b30b95168626b36",
            "69c139b2d087a345",
            "d7a4dde06ee31064",
            "616e1cea6a58e185",
            "725938fa0b6c40f3",
            "a519cd8a7f0eb26c",
            "7071f2e33ed83996",
            "e79d48ebdc349cdf",
            "b220638376516a8f"
        ],
        "x": 74,
        "y": 259,
        "w": 1052,
        "h": 262
    },
    {
        "id": "a9b84b854e281eb5",
        "type": "group",
        "z": "8cd62b9679ad11ce",
        "name": "Работа с бд",
        "style": {
            "label": true
        },
        "nodes": [
            "78f98ed8537f4b31",
            "7a89d7535010efb2",
            "36386a2733d98b70",
            "ed89fe60e9d7c467",
            "28dae3d0cb6655d8",
            "a031472365e48814",
            "31f240fb5e34c6ec",
            "c4ce28bbe2d59123",
            "57d2671daa8fefc1",
            "bbb778ecb3facdf4",
            "36e9e80567617f4d",
            "b46a07e5bed22e6c",
            "6615d5887534ac85",
            "66a4d0f8b9d0badf",
            "dfb926319df5112a",
            "dc52fc295be87803",
            "a63b5d1a5f774d98",
            "d1204b1faf51d6c4",
            "954ccfcc18f82b4e",
            "16aed3ba96a53f69",
            "1568bd5286e59760",
            "f21aaa2a0d85371c"
        ],
        "x": 114,
        "y": 319,
        "w": 972,
        "h": 382
    },
    {
        "id": "6cebdc9467483554",
        "type": "group",
        "z": "b8ad15e59845239e",
        "name": "Работа с бд",
        "style": {
            "label": true
        },
        "nodes": [
            "ef7a5da9587957db",
            "0ad1669754d81440",
            "c670a2a0e1a147cd",
            "506a261d3026523f",
            "4435b9b11e8bb8df",
            "521a5e7271fcb269",
            "c0f3b2afb792826c",
            "0a156d769dc90c6e",
            "86716a0157a63135",
            "e830fc36391e8aca",
            "f90b46636f0f5855",
            "d07dc257cc2e7b34",
            "ade0f032a5d1969d",
            "30f9663de217782b",
            "cbaffe357d4b92cc",
            "4d9fdba8846ce6c9",
            "7b8d6d98e2cc821c",
            "5d7b2b3a65369fd3",
            "45113b6952cab182",
            "191d03ab4cc2074e",
            "d2ce509bad35943e",
            "caf2fa8abd83d2c3"
        ],
        "x": 414,
        "y": 559,
        "w": 972,
        "h": 382
    },
    {
        "id": "a519e155bc922db2",
        "type": "group",
        "z": "96b3a7bdffc02a46",
        "name": "Управление данными",
        "style": {
            "label": true
        },
        "nodes": [
            "e5d158a3ae78ec1a",
            "5c7b9c92bcb7ee73",
            "2c819fb8d09af4d6",
            "6821cc9a1df2189c",
            "50f6a24a6e844c76",
            "618294bd0f113014",
            "e552a021628338bf"
        ],
        "x": 954,
        "y": 819,
        "w": 592,
        "h": 202
    },
    {
        "id": "13fec579f68ce93d",
        "type": "group",
        "z": "96b3a7bdffc02a46",
        "name": "Управление данными таблицы labs",
        "style": {
            "label": true
        },
        "nodes": [
            "aa679fe189fb4651",
            "c060d4599a37ba5f",
            "fced7c6a7b89032d",
            "415428279bb167f0",
            "bfdf81b6864d1335",
            "260af056ef3e2c3a",
            "324bea94568f0069",
            "ea97fab4d4c4715c",
            "8423d1604e4825e1",
            "5bf97b91822d3be6",
            "2d3b30007ace24fa",
            "b85fe9a5d218d2f2",
            "40bca252d5409afe",
            "1425954943a3cbd3",
            "2d6773fcfdd5309f",
            "e4013aa985385184",
            "173749770eaef22b",
            "39a537873bcf5653",
            "e00aadd15fd5fb40"
        ],
        "x": 24,
        "y": 779,
        "w": 862,
        "h": 382
    },
    {
        "id": "dc57bd4872fb081c",
        "type": "group",
        "z": "d0d8641abf4dd3c2",
        "name": "Аутентификация",
        "style": {
            "label": true,
            "stroke": "#ffff00",
            "fill": "#ffff00",
            "color": "#000000"
        },
        "nodes": [
            "031851d130f15efc",
            "adc40443080e308e",
            "8669f4ba32fc71d4",
            "5b26c220827026c3",
            "c8c20f6a2c691098",
            "c27ea31347dad363",
            "0b6d738d7e97f835",
            "36a3ac2c32677eac",
            "97193aab93ec9e56",
            "27c33b68edee51eb",
            "2377d29ed80e9cf9"
        ],
        "x": 14,
        "y": 499,
        "w": 1132,
        "h": 182
    },
    {
        "id": "498fbf74c49afb10",
        "type": "group",
        "z": "d0d8641abf4dd3c2",
        "name": "Регистрация",
        "style": {
            "label": true
        },
        "nodes": [
            "e7178670a25a18b8",
            "6b8f79edd8aac21d",
            "d1e1ee10de33ede4",
            "3c9d1b24b24ae747",
            "618bc6b82f23d01c",
            "b76e496ea8b8958c",
            "b1e0307f423abf6e",
            "dae4ea71260b3920",
            "b49a245a351586b4",
            "c8c7b346cb27b9aa",
            "31e15ad0550e236f",
            "8f4fbb8f32372c69",
            "c203fc9c1159ab64",
            "10cd1b14c7995373",
            "da9b55839080b175",
            "9370873a09365f55",
            "d40d83bd0ca25087",
            "ff034c38362a0987"
        ],
        "x": 94,
        "y": 739,
        "w": 1412,
        "h": 302
    },
    {
        "id": "08dea3c2803be79b",
        "type": "group",
        "z": "d0d8641abf4dd3c2",
        "name": "Работа с бд",
        "style": {
            "label": true
        },
        "nodes": [
            "443cd013942e049b",
            "07502029eb702eb5",
            "0e83a3bbd8e179e9",
            "c63632fc28ce11a6",
            "b6ff6bf0a2db0f73",
            "76611972ca3c4eea",
            "1817f3efaa191a75",
            "3624767e91f5e2c5",
            "0452e331b7f0d51e",
            "372f518119c12c96",
            "607b053169d04a43",
            "87fd58b7ed0389d1",
            "eafb07e8b93f3ac6",
            "90e9e2d1f7f9d36a",
            "89842634261a77ac",
            "c7b205b79a37f418",
            "7f6525641d53d94a",
            "d6d068aaeeea77ab",
            "7edf5bacb90fb74f",
            "d9a8de37694d2f8f",
            "05b8799d743f5910",
            "fbb421f7dbfb0684",
            "680c496ed65e1fd7",
            "e1fb6ce89826a9dc",
            "302c954ed4b68337"
        ],
        "x": 74,
        "y": 19,
        "w": 972,
        "h": 442
    },
    {
        "id": "d3f44785a6cfb327",
        "type": "sqlitedb",
        "db": "C:\\sqlite\\myusersdb.db",
        "mode": "RWC"
    },
    {
        "id": "eb6104075409be7d",
        "type": "http in",
        "z": "96b3a7bdffc02a46",
        "g": "b83cceb90218bb16",
        "name": "",
        "url": "/subject",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "a63363f6d6ed75e1"
            ]
        ]
    },
    {
        "id": "3043fb2166b3eba3",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "b83cceb90218bb16",
        "name": "css",
        "func": "var css = `\nbody {\n    font-family: Arial, sans-serif;\n    margin: 0;\n    padding: 0;\n    height: 1200px;\n    background-color: #edf3fec1;\n}\n\n.topbar {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 80px;\n    background-color: #fff;\n    color: white;\n    display: flex;\n    align-items: center;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding-left: 20px;\n    z-index: 1;\n}\n\n\n.sidebar {\n    width: 45px;\n    height: 100%;\n    background-color: #fff;\n    color: white;\n    position: fixed;\n    top: 0;\n    left: 0;\n    transition: width 0.3s;\n    overflow: visible;\n    white-space: nowrap;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding: 10px;\n    z-index: 10;\n}\n\n.sidebar.expanded1 {\n    width: 340px;\n    transition: width 0.7s ease; \n}\n\n.sidebar:hover {\n    width: 340px;\n    transition: width 0.7s ease; \n}\n\n.toggle-btn {\n    cursor: pointer;\n    text-align: center;\n    padding: 10px;\n    background-color: #EDF3FE;\n    border: none;\n    color: white;\n    width: 33px;\n    height: 33px;\n    border-radius: 50%;\n    outline: none;\n    position: absolute;\n    left: 82%;\n    top: 40px;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding: 10px;\n}\n\n.toggle-btn.expanded1 {\n    transform: rotate(180deg);\n}\n\n.toggle-btn img {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    display: block;\n    transition: transform 0.2s ease;\n}\n\n.button-list {\n    list-style-type: none;\n    padding: 0;\n    margin: 0;\n}\n\n.button-list li {\n    display: flex;\n    align-items: center;\n    padding: 10px;\n}\n\n.button-list li img {\n    width: 24px;\n    height: 24px;\n    margin-right: 10px;\n}\n\n.button-list li:hover {\n    background-color: #555;\n}\n\n.text {\n    display: none;\n}\n\n.sidebar.expanded .text {\n    display: inline;\n}\n\n.sidebar:hover .text {\n    display: inline;\n}\n\n.logo {\n    width: 30px;\n    height: auto;\n    left: 84%;\n}\n\n.logo.small {\n    width: 300px;\n    height: auto;\n    transition: width 0.5s ease; \n}\n\n.logocenter {\n    border: 5px solid;\n    position: absolute;\n    top: 45px;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    padding: 10px;\n}\n\n.logocenter.small {\n    border: 6px solid;\n    position: absolute;\n    top: 110px;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    padding: 10px;\n}\n\n.logoname {\n    width: 230px;\n    height: auto;\n}\n\n.divlogoname {\n    height: auto;\n    position: absolute;\n    top: 20px;\n    left: 80px;\n    padding: 10px;\n}\n\n.menu {\n    list-style: none;\n    position: absolute;\n    color: black;\n    top: 60px;\n    width: 95%;\n    padding: 0;\n    margin: 40px 0 0 0;\n    transition: transform 0.7s ease;\n}\n\n.menu.small {\n    list-style: none;\n    position: absolute;\n    color: black;\n    top: 170px;\n    width: 95%;\n    padding: 0;\n    margin: 40px 0 0 0;\n}\n\n.menu li {\n    display: flex;\n    align-items: center;\n    padding: 12px;\n    cursor: pointer;\n    transition: background 0.6s;\n}\n\n.menu li:hover {\n    background: #EDF3FE;\n}\n\n.icon {\n    width: 24px;\n    height: 24px;\n    margin-right: 40px;\n}\n\n.text {\n    display: inline-block; \n    opacity: 0;\n    transition: opacity 0.3s ease 0.8s;\n    font-size: 18px;\n}\n\n.sidebar:not(.expanded1) .menu li,\n.sidebar:hover:not(.expanded1) .menu li {\n    justify-content: left;\n}\n\n.sidebar:not(.expanded1) .text {\n    opacity: 0;\n    visibility: hidden;\n}\n\n.sidebar.expanded1 .menu li,\n.sidebar:hover .menu li {\n    \n    ustify-content: flex-start;\n    padding-left: 5px;\n}\n\n.sidebar.expanded1 .text,\n.sidebar:hover .text {\n    opacity: 1;\n    visibility: visible;\n    transition-delay: 0.8s;\n}\n\n.main_content {\n    top: 105px;\n    position: relative;\n    color: black;\n    margin-top: 10px;\n    margin-left: 100px;\n    padding: 2px;\n    transition: margin-left 0.3s ease;\n  }\n  \n  .sidebar.expanded1 ~ .main_content {\n    margin-left: 400px;\n  }\n  \n.info-box {\n    text-align: center;\n}\n  \n.info-label {\n    margin-bottom: 10px;\n    font-size: 18px;\n    font-weight: bold;\n}\n  \n.info-rectangle {\n    width: 98%;\n    padding-right: -100px;\n    background-color: #fcfcfc;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    border-radius: 10px;\n}\n\n.table {\n    display: grid;\n    padding: 5px;\n    grid-template-columns: 6.5vw 1fr 1fr 1fr 1fr 1fr 1fr;\n    gap: 5px;\n}\n\n.row {\n    display: contents;\n}\n\n.cell {\n    background: white;\n    padding: 20px;\n    border-radius: 10px;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    min-height: 30px;\n    text-align: left;\n}\n\n.header-row .cell {\n    background: #EDF3FE;\n    font-weight: bold;\n    text-align: center;\n}\n\n.time {\n    font-weight: bold;\n    background: #EDF3FE;\n    padding: 20px;\n}\n\n.subject a {\n    color: blue;\n    text-decoration: none;\n}\n\n.subject {\n    cursor: pointer;\n    background-color: #fff;\n    font-size: 14px;\n    line-height: 1.4;\n    transition: background-color 0.3s;\n  }\n  \n  .subject:hover {\n    background-color: #dee7f9c8\n  }\n\n.green { border-left: 5px solid green; }\n.blue { border-left: 5px solid rgb(0, 68, 255); }\n.purple { border-left: 5px solid purple; }\n.red { border-left: 5px solid rgb(133, 6, 6); }\n.cyan { border-left: 5px solid rgb(17, 4, 90); }\n\n.info-subject {\n    margin-bottom: 10px;\n    font-size: 30px;\n    font-weight: bold;\n}\n  \n.task_info_table {\n    display: grid;\n    padding: 6px;\n    grid-template-columns: 1fr 3fr;\n    gap: 5px;\n}\n\n@media (max-width: 1000px) {\n    .task_info_table {\n      grid-template-columns: 1.9fr 2fr;\n    }\n}\n\n@media (max-width: 1600px) {\n    .task_info_table {\n      grid-template-columns: 1.7fr 3fr;\n    }\n}\n\n@media (max-width: 1300px) {\n    .task_info_table {\n      grid-template-columns: 1fr 3fr;\n    }\n}\n\n@media (max-width: 850px) {\n    .task_info_table {\n      grid-template-columns: 3fr 1fr;\n    }\n}\n\n\n.task_state {\n    min-height: 150px;\n    background: #EDF3FE;\n    padding: 20px;\n    transition: all 0.3s ease;\n}\n\n.task_table {\n    display: grid;\n    min-width: 360px;\n    background: #EDF3FE;\n    grid-template-columns: 1fr 1fr 1fr 1fr 1fr;\n    gap: 5px;\n}\n\n@media (max-width: 2300px) {\n    .task_table {\n      grid-template-columns: 1fr 1fr 1fr 1fr;\n    }\n}\n\n@media (max-width: 1500px) {\n    .task_table {\n      grid-template-columns: 1fr 1fr 1fr;\n    }\n    .task_state {\n        min-width: 300px;\n    }\n}\n\n@media (max-width: 1000px) {\n    .task_table {\n      grid-template-columns: 1fr 1fr;\n    }\n}\n\n@media (max-width: 900px) {\n    .task_table {\n      grid-template-columns: 1fr;\n      min-width: 200px;\n    }\n}\n\n@media (max-width: 810px) {\n    .task_info_table {\n        grid-template-columns: 1fr;\n    }\n}\n\n.task {\n    background: white;\n    padding: 20px;\n    border-radius: 10px;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    min-height: 50px;\n    text-align: left;\n}\n\n.teacher-card {\n    background: white;\n    border-radius: 10px;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding: 20px;\n    max-width: 600px;\n    min-width: 300px;\n    margin: 0 auto;\n  }\n  \n  .teacher-title {\n    font-size: 18px;\n    font-weight: bold;\n    text-align: left;\n    margin: 0 0 15px 0;\n    padding-left: 10px;\n  }\n  \n  .teacher-info {\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n  }\n  \n  .teacher-photo {\n    width: 100px;\n    height: 100px;\n    border-radius: 50%;\n    object-fit: cover;\n    margin-right: 20px;\n  }\n  \n  .teacher-details {\n    flex: 1;\n    text-align: left;\n  }\n  \n  .teacher-details p {\n    margin: 5px 0;\n  }\n  \n  .msg-button {\n    margin-top: 10px;\n    background-color: #0017e2;\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 14px;\n  }\n  \n  .msg-button:hover {\n    background-color: #3054b8;\n  }\n  \n  .hidden {\n    display: none;\n  }\n  \n  .lab-details {\n    background: white;\n    border-radius: 10px;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding: 20px;\n    max-width: 500px;\n    margin: 0 auto;\n  }\n  \n  .lab-comment {\n    padding: 20px;\n  }\n\n.task-status {\n    font-size: 14px;\n    color: #f00;\n    margin-top: 8px;\n  }\n  \n  .assignment-details {\n    position: relative;\n    color: black;\n    margin-top: 10px;\n    transition: margin-left 0.3s ease;\n  }\n  \n  .progress-container {\n    background-color: #f3f3f3;\n    border-radius: 8px;\n    height: 10px;\n    overflow: hidden;\n    margin-top: 10px;\n  }\n  \n  .progress-bar {\n    height: 100%;\n    background-color: #4caf50;\n    transition: width 1s ease;\n  }\n.task_p {\n  padding: 30px;\n}\n\n.loader-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 1200px;\n  background-color: #f5f5f5;\n}\n\n.loader {\n  border: 8px solid #f3f3f3;\n  border-top: 8px solid #164073;\n  border-radius: 50%;\n  width: 60px;\n  height: 60px;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n.loader-container p {\n  margin-top: 20px;\n  font-size: 18px;\n  color: #333;\n}\n.modal {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: white;\n      padding: 20px;\n      border-radius: 10px;\n      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n      z-index: 1000;\n      width: 400px;\n      max-width: 90%;\n    }\n\n    .modal input,\n    .modal select,\n    .modal textarea {\n      width: 100%;\n      padding: 8px;\n      margin: 8px 0;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n    }\n\n    .modal textarea {\n      height: 100px;\n      resize: vertical;\n    }\n\n    .modal button {\n      padding: 8px 16px;\n      margin: 8px 5px 0 0;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n\n    .add-lab-button {\n      background: #EDF3FE;\n      padding: 15px;\n      text-align: center;\n      border-radius: 10px;\n      cursor: pointer;\n      margin-top: 10px;\n      font-weight: bold;\n      transition: background 0.3s;\n    }\n\n    .add-lab-button:hover {\n      background: #dee7f9c8;\n    }\n\n    .edit-lab-button {\n      background: #0017e2;\n      color: white;\n      border: none;\n      padding: 5px 10px;\n      border-radius: 5px;\n      cursor: pointer;\n      margin-top: 10px;\n      font-size: 12px;\n    }\n\n    .edit-lab-button:hover {\n      background: #3054b8;\n    }\n`;\n\nmsg.cssText = css;\nmsg.userRole = msg.userRole;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 180,
        "wires": [
            [
                "6ad66adbfcccd7fe"
            ]
        ]
    },
    {
        "id": "6ad66adbfcccd7fe",
        "type": "template",
        "z": "96b3a7bdffc02a46",
        "g": "b83cceb90218bb16",
        "name": "Внешний вид предмета",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"ru\">\n\n<head>\n  <meta charset=\"UTF-8\" />\n  <title id=\"subjectTitle\">Информация о предмете</title>\n  <style>\n    {{{cssText}}}\n  </style>\n  <link rel=\"icon\" type=\"image/png\" href=\"https://cabinet.ssau.ru/asset/favicon.ico\">\n</head>\n\n<body>\n  <header class=\"topbar\">\n    <div class=\"divlogoname\"><img src=\"https://sun9-71.userapi.com/impg/5bKKjXmZHXD-py_TrIJPKFRQ7bS0QHjZuGtpmw/76Nc37KiTHI.jpg?size=1890x185&quality=95&sign=f3cefb5512a49c2d843e894fda497b97&type=album\" class=\"logoname\">\n    </div>\n  </header>\n\n  <div class=\"sidebar\" id=\"sidebar\">\n    <div class=\"logocenter\" id=\"logocenter\">\n      <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png\" class=\"logo\" id=\"logo\">\n    </div>\n    <button class=\"toggle-btn\" id=\"toggleBtn\">\n        <img src=\"https://github.com/Kulakov1Dima/SsauWorkspace/blob/main/hahaton_exemple_fronted/expand.png?raw=true\">\n    </button>\n    <ul class=\"menu\" id=\"menu\">\n      <li>\n        <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/home1.png\" class=\"icon\">\n        <span class=\"text\">Главная</span>\n      </li>\n      <li>\n        <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/messenger.png\" class=\"icon\">\n        <span class=\"text\">Мессенджер</span>\n      </li>\n      <li onclick=\"location.href='http://localhost:1880/ssau';\" style=\"cursor:pointer;\">\n        <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/schedule.png\" class=\"icon\">\n        <span class=\"text\">Расписание</span>\n      </li>\n    </ul>\n  </div>\n\n  <!-- Модальное окно для добавления/редактирования лабораторной работы -->\n  <div class=\"modal\" id=\"labModal\" style=\"display: none;\">\n    <h3 id=\"modalTitle\">Добавить лабораторную работу</h3>\n    <input type=\"text\" id=\"labTitle\" placeholder=\"Название работы\">\n    <select id=\"labStatusSelect\">\n          <option value=\"Не сдано\">Не сдано</option>\n          <option value=\"В процессе\">В процессе</option>\n          <option value=\"Сдано\">Сдано</option>\n          <option value=\"Проверяется\">Проверяется</option>\n          <option value=\"Требует доработки\">Требует доработки</option>\n      </select>\n    <input type=\"number\" id=\"labProgress\" placeholder=\"Прогресс (0-100)\" min=\"0\" max=\"100\">\n    <textarea id=\"labComment\" placeholder=\"Комментарий преподавателя\"></textarea>\n    <textarea id=\"labTask\" placeholder=\"Описание задания\"></textarea>\n    <button onclick=\"saveLab()\">ОК</button>\n    <button onclick=\"closeLabModal()\">Отмена</button>\n  </div>\n\n  <div class=\"main_content\">\n    <div class=\"info-subject\"></div>\n    <div class=\"info-rectangle\">\n      <div class=\"task_info_table\">\n        <div class=\"row\">\n          <div class=\"cell task_state\">\n\n            <div class=\"lab-details hidden\">\n              <div class=\"info-rectangle\">\n                <div class=\"lab-comment\">\n                  <h3>Комментарий преподавателя</h3>\n                  <p id=\"labCommentText\"></p>\n                  <h4>Статус: <span id=\"labStatusDisplay\"></span></h4>\n                  <div class=\"progress-container\">\n                    <div class=\"progress-bar\" id=\"labProgressBar\" style=\"width: 0%\"></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"teacher-card\">\n              <h4 class=\"teacher-title\">Ваш преподаватель</h4>\n              <div class=\"teacher-info\">\n                <img src=\"https://cdn-icons-png.flaticon.com/512/4837/4837857.png\" alt=\"Преподаватель\" class=\"teacher-photo\" id=\"teacherPhoto\">\n                <div class=\"teacher-details\">\n                  <p id=\"teacherName\"></p>\n                  <p>Email: <a href=\"mailto:ivanov@example.com\" id=\"teacherEmail\"></a></p>\n                  <button class=\"msg-button\">Написать сообщение</button>\n                </div>\n              </div>\n            </div>\n\n            <p id=\"subjectDescription\"></p>\n\n          </div>\n          <div class=\"cell task_state\">\n            <div class=\"task_table\" id=\"taskTable\">\n            </div>\n            <div class=\"add-lab-button\" onclick=\"openAddLabModal()\" id=\"add-lab-button\">\n              <span>+ Добавить лабораторную работу</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <script>\n    const imagesToPreload = [\n    \"http://localhost:1880/logo_osnovnoy.png\",\n    \"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png\"\n    ];\n    \n    imagesToPreload.forEach(src => {\n    const img = new Image();\n    img.src = src;\n    });\n    \n    const sidebar = document.getElementById('sidebar');\n    const toggleBtn = document.getElementById('toggleBtn');\n    const logo = document.getElementById('logo');\n    const logocenter = document.getElementById('logocenter');\n    const menu = document.getElementById('menu');\n\n    toggleBtn.addEventListener('click', () => {\n        if (!toggleBtn.classList.contains('expanded1')) {\n            toggleBtn.classList.add('expanded1');\n            sidebar.classList.add('expanded1');\n        }\n        else{\n            toggleBtn.classList.remove('expanded1');\n            sidebar.classList.remove('expanded1');\n        }\n    });\n\n    sidebar.addEventListener('mouseenter', () => {\n        logo.src = 'http://localhost:1880/logo_osnovnoy.png';\n        logo.classList.add('small');\n        logocenter.classList.add('small');\n        menu.classList.add('small');\n    });\n\n    sidebar.addEventListener('mouseleave', () => {\n        if (!sidebar.classList.contains('expanded1')) {\n            logo.src = 'https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png';\n            logo.classList.remove('small');\n            logocenter.classList.remove('small');\n            menu.classList.remove('small');\n        }\n    });\n    \n    // Проверяем, является ли пользователь преподавателем\n    const userRole = '{{userRole}}' || 'student';\n    const isTeacher = userRole === 'teacher';\n\n    let currentLabId = null;\n    const subjectName = new URLSearchParams(window.location.search).get('name');\n\n    const teacherAddLabButton = document.getElementById('add-lab-button');\n    if (isTeacher) {\n      teacherAddLabButton.style.display = 'flex';\n    } else {\n      teacherAddLabButton.style.display = 'none';\n    }\n    \n    // Функции для работы с модальным окном лабораторных работ\n    function openAddLabModal() {\n    document.getElementById('modalTitle').textContent = 'Добавить лабораторную работу';\n    document.getElementById('labTitle').value = '';\n    document.getElementById('labStatusSelect').value = 'Не сдано';\n    document.getElementById('labProgress').value = '0';\n    document.getElementById('labComment').value = '';\n    document.getElementById('labTask').value = '';\n    currentLabId = null;\n    document.getElementById('labModal').style.display = 'block';\n    }\n\n    function openEditLabModal(labId, labData) {\n    document.getElementById('modalTitle').textContent = 'Редактировать лабораторную работу';\n    document.getElementById('labTitle').value = labData.title;\n    document.getElementById('labStatusSelect').value = labData.status;\n    document.getElementById('labProgress').value = labData.progress;\n    document.getElementById('labComment').value = labData.comment || '';\n    document.getElementById('labTask').value = labData.task || '';\n    currentLabId = labId;\n    document.getElementById('labModal').style.display = 'block';\n    }\n\n    function closeLabModal() {\n        document.getElementById('labModal').style.display = 'none';\n    }\n\n    function saveLab() {\n    const labData = {\n    subject_name: subjectName,\n    title: document.getElementById('labTitle').value,\n    status: document.getElementById('labStatusSelect').value,\n    progress: parseInt(document.getElementById('labProgress').value),\n    comment: document.getElementById('labComment').value,\n    task: document.getElementById('labTask').value\n    };\n    \n    if (!labData.title) {\n    alert('Пожалуйста, введите название работы');\n    return;\n    }\n    \n    const url = currentLabId ? `http://localhost:1880/lab/${currentLabId}` : 'http://localhost:1880/labs';\n    const method = currentLabId ? 'PUT' : 'POST';\n    \n    fetch(url, {\n    method: method,\n    headers: {\n    'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(labData)\n    })\n    .then(response => response.json())\n    .then(() => {\n    closeLabModal();\n    window.location.reload();\n    })\n    .catch(error => {\n    console.error('Ошибка сохранения:', error);\n    alert('Ошибка сохранения данных');\n    });\n    }\n\n    // Добавляем кнопки редактирования к лабораторным работам (для преподавателей)\n    function addEditButtonsToLabs() {\n        if (!isTeacher) return;\n        \n        document.querySelectorAll('.task').forEach(task => {\n            const labId = task.dataset.labId;\n            const editButton = document.createElement('button');\n            editButton.textContent = 'Изменить данные';\n            editButton.className = 'edit-lab-button';\n            editButton.onclick = (e) => {\n                e.stopPropagation();\n                fetch(`http://localhost:1880/lab/${labId}`)\n                    .then(response => response.json())\n                    .then(data => openEditLabModal(labId, data));\n            };\n            task.appendChild(editButton);\n        });\n    }\n\n    document.addEventListener('DOMContentLoaded', () => {\n      const tasks = document.querySelectorAll('.task');\n      const teacherCard = document.querySelector('.teacher-card');\n      const labDetails = document.querySelector('.lab-details');\n      const labComment = document.getElementById('labComment');\n      const labStatus = document.getElementById('labStatus');\n      const labProgressBar = document.getElementById('labProgressBar');\n      const taskTable = document.getElementById('taskTable');\n\n      taskTable.addEventListener('click', async (event) => {\n        const task = event.target.closest('.task');\n        if (!task || event.target.classList.contains('edit-lab-button')) return;\n\n        const labId = task.dataset.labId;\n        if (!labId) return;\n        try {\n          const response = await fetch(`http://localhost:1880/lab/${labId}`);\n          const labData = await response.json();\n\n          labCommentText.textContent = labData.comment;\n          labStatusDisplay.textContent = labData.status;\n          labProgressBar.style.width = `${labData.progress}%`;\n\n          labDetails.classList.remove('hidden');\n          teacherCard.classList.add('hidden');\n\n          let existingAssignment = document.querySelector('.assignment-details');\n          if (!existingAssignment) {\n            existingAssignment = document.createElement('div');\n            existingAssignment.className = 'assignment-details main_content';\n            document.body.appendChild(existingAssignment);\n          }\n\n          let taskWithConsole = labData.task;\n          if (taskWithConsole.includes('[[CONSOLE]]')) {\n            const consoleHTML = `<iframe src=\\\"https://mail.ru\\\" style=\\\"width:100%; height:480px; border:none; margin-top:20px;\\\"></iframe>`;\n            taskWithConsole = taskWithConsole.replace('[[CONSOLE]]', consoleHTML);\n          }\n          if (taskWithConsole.includes('[[PYTHON]]')) {\n            const consoleHTML = `<div id=\\\"pythonLoader\\\" class=\\\"loader-container\\\"><div class=\\\"loader\\\"></div><p>Загрузка Jupyter Notebook...</p></div><iframe id=\\\"pythonIframe\\\" src=\\\"http://127.0.0.1:8888/notebooks/Untitled.ipynb\\\"\\n              style=\\\"width:100%; height:1200px; border:none; margin-top:20px; display:none;\\\"\\n              sandbox=\\\"allow-scripts allow-same-origin allow-popups allow-forms\\\"></iframe>`;\n            taskWithConsole = taskWithConsole.replace('[[PYTHON]]', consoleHTML);\n            setTimeout(() => {\n              const pythonIframe = document.getElementById('pythonIframe');\n              const pythonLoader = document.getElementById('pythonLoader');\n              \n              pythonIframe.onload = () => {\n                pythonLoader.style.display = 'none';\n                pythonIframe.style.display = 'block';\n                };\n            }, 0);\n          }\n\nexistingAssignment.innerHTML = `\n<div class=\"assignment-details\">\n  <div class=\"info-rectangle\">\n    <div class=\"task_p\">\n      <h3>Задание лабораторной работы</h3>\n      <p>${taskWithConsole}</p>\n      <p>Статус: <span class=\"assignment-status\">${labData.status}</span></p>\n      <div class=\"progress-container\">\n        <div class=\"progress-bar\" style=\"width: ${labData.progress}%;\"></div>\n      </div>\n    </div>\n  </div>\n</div>\n`;\n} catch (error) {\nconsole.error('Ошибка при загрузке данных:', error);\n}\n});\n\n  const urlParams = new URLSearchParams(window.location.search);\n  let subjectName = urlParams.get('name');\n\n  if (!subjectName || subjectName === \"null\") {\n    window.location.href = 'error.html';\n  } else {\n    const infoLabel = document.querySelector('.info-subject');\n    infoLabel.textContent = subjectName;\n    document.getElementById(\"subjectTitle\").textContent = subjectName;\n    document.getElementById(\"subjectDescription\").textContent = `Здесь могла бы быть подробная информация о предмете «${subjectName}».`;\n\n    const defaultTeacher = {\n      name: \"Не найден\",\n      email: \"null\",\n      photo: \"https://cdn-icons-png.flaticon.com/512/4837/4837857.png\"\n    };\n\n    fetch(`http://localhost:1880/teacher${encodeURIComponent(subjectName)}`)\n      .then(response => response.json())\n      .then(data => {\n        document.getElementById('teacherPhoto').src = data.photo || defaultTeacher.photo;\n        document.getElementById('teacherName').textContent = data.name || defaultTeacher.name;\n        document.getElementById('teacherEmail').href = `mailto:${data.email || defaultTeacher.email}`;\n        document.getElementById('teacherEmail').textContent = data.email || defaultTeacher.email;\n      })\n      .catch(error => {\n        console.error('Ошибка получения данных преподавателя:', error);\n        document.getElementById('teacherPhoto').src = defaultTeacher.photo;\n        document.getElementById('teacherName').textContent = defaultTeacher.name;\n        document.getElementById('teacherEmail').href = `mailto:${defaultTeacher.email}`;\n        document.getElementById('teacherEmail').textContent = defaultTeacher.email;\n      });\n\n    fetch(`http://localhost:1880/labs/${encodeURIComponent(subjectName)}`)\n      .then(response => response.json())\n      .then(data => {\n        data.forEach(lab => {\n          const labDiv = document.createElement('div');\n          labDiv.className = 'task subject';\n          labDiv.dataset.labId = lab.id;\n\n          if (lab.status === \"Сдано\") {\n            labDiv.classList.add('green');\n          } else if (lab.status === \"Не сдано\") {\n            labDiv.classList.add('red');\n          } else if (lab.status === \"В процессе\") {\n            labDiv.classList.add('blue');\n          }\n\n          labDiv.innerHTML = `\n            <b>${lab.title}</b><br>\n            <span>Статус: ${lab.status}</span>\n          `;\n          taskTable.appendChild(labDiv);\n        });\n        \n        addEditButtonsToLabs(); // Добавляем кнопки редактирования\n      })\n      .catch(error => {\n        console.error('Ошибка при загрузке данных:', error);\n      });\n  }\n});\n  </script>\n</body>\n\n</html>",
        "output": "str",
        "x": 1070,
        "y": 100,
        "wires": [
            [
                "db4560c7c2073a98"
            ]
        ],
        "icon": "node-red/parser-html.svg"
    },
    {
        "id": "db4560c7c2073a98",
        "type": "http response",
        "z": "96b3a7bdffc02a46",
        "g": "b83cceb90218bb16",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1290,
        "y": 100,
        "wires": []
    },
    {
        "id": "acc184a576fc1127",
        "type": "http in",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "url": "/labs/:subject_name",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 300,
        "wires": [
            [
                "e94ef20631abe1fc"
            ]
        ]
    },
    {
        "id": "e94ef20631abe1fc",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "Получение лабораторных",
        "func": "const subjectName = msg.req.params.subject_name;\n\nmsg.topic = \"SELECT id, title, status FROM labs WHERE subject_name = \\\"\" + subjectName +\"\\\"\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 300,
        "wires": [
            [
                "eed8cf825b35c359"
            ]
        ]
    },
    {
        "id": "0c36d0543db77def",
        "type": "http response",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 890,
        "y": 300,
        "wires": []
    },
    {
        "id": "6bd9fdcda1dda3e7",
        "type": "http in",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "url": "/lab/:lab_id",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 360,
        "wires": [
            [
                "a2b7d415a98b5d0f"
            ]
        ]
    },
    {
        "id": "a2b7d415a98b5d0f",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "Получение лабораторных",
        "func": "const lab_id = msg.req.params.lab_id;\n\nmsg.topic = \"SELECT * FROM labs WHERE id = \\\"\" + lab_id + \"\\\"\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 360,
        "wires": [
            [
                "43c91f459a58a328"
            ]
        ]
    },
    {
        "id": "9aa00395d33b40c5",
        "type": "http response",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 360,
        "wires": []
    },
    {
        "id": "9b30b95168626b36",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "[0]",
        "func": "msg.payload = msg.payload[0];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 360,
        "wires": [
            [
                "9aa00395d33b40c5"
            ]
        ]
    },
    {
        "id": "eed8cf825b35c359",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "/*\nЗа раз можно сделать одну таблицу,\nпоэтому комментируй остальное\n */\nCREATE TABLE labs (\n    id INTEGER PRIMARY KEY,\n    subject_name TEXT,\n    title TEXT,\n    status TEXT,\n    message TEXT\n);",
        "name": "labs",
        "x": 730,
        "y": 300,
        "wires": [
            [
                "0c36d0543db77def"
            ]
        ]
    },
    {
        "id": "43c91f459a58a328",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "/*\nЗа раз можно сделать одну таблицу,\nпоэтому комментируй остальное\n */\nCREATE TABLE labs (\n    id INTEGER PRIMARY KEY,\n    subject_name TEXT,\n    title TEXT,\n    status TEXT,\n    message TEXT\n);",
        "name": "labs",
        "x": 730,
        "y": 360,
        "wires": [
            [
                "9b30b95168626b36"
            ]
        ]
    },
    {
        "id": "a63363f6d6ed75e1",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "b83cceb90218bb16",
        "name": "Проверка авторизации",
        "func": "// Проверяем куки\nif (!msg.req.cookies || !msg.req.cookies.auth_token) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\n// Получаем ID пользователя из куки\nconst userId = msg.req.cookies.user_id;\nif (!userId) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\nmsg.topic = `SELECT * FROM users WHERE id = '${userId}'`;\nmsg.userId = userId;\n\n// Здесь можно добавить проверку валидности токена\n// Например, сравнить с хранящимся в памяти или БД\n\nreturn [msg, null];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 100,
        "wires": [
            [
                "1463063b4c77a5db"
            ],
            [
                "db4560c7c2073a98"
            ]
        ]
    },
    {
        "id": "e5d158a3ae78ec1a",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "a519e155bc922db2",
        "name": "Создать БД",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1070,
        "y": 860,
        "wires": [
            [
                "5c7b9c92bcb7ee73"
            ]
        ]
    },
    {
        "id": "5c7b9c92bcb7ee73",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "a519e155bc922db2",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "fixed",
        "sql": "/*\nЗа раз можно сделать одну таблицу,\nпоэтому комментируй остальное\n */\nCREATE TABLE labs (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    subject_name TEXT,\n    title TEXT,\n    progress INTEGER,\n    status TEXT,\n    comment TEXT,\n    task TEXT\n);",
        "name": "labs",
        "x": 1290,
        "y": 860,
        "wires": [
            [
                "2c819fb8d09af4d6"
            ]
        ]
    },
    {
        "id": "2c819fb8d09af4d6",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "a519e155bc922db2",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 860,
        "wires": []
    },
    {
        "id": "6821cc9a1df2189c",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "a519e155bc922db2",
        "name": "Вывод списка БД",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SELECT name FROM sqlite_master WHERE type='table';",
        "x": 1090,
        "y": 920,
        "wires": [
            [
                "50f6a24a6e844c76"
            ]
        ]
    },
    {
        "id": "50f6a24a6e844c76",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "a519e155bc922db2",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "labs",
        "x": 1290,
        "y": 920,
        "wires": [
            [
                "618294bd0f113014"
            ]
        ]
    },
    {
        "id": "618294bd0f113014",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "a519e155bc922db2",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1450,
        "y": 920,
        "wires": []
    },
    {
        "id": "e552a021628338bf",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "a519e155bc922db2",
        "name": "Удалить таблицу",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "DROP TABLE labs",
        "x": 1080,
        "y": 980,
        "wires": [
            [
                "50f6a24a6e844c76"
            ]
        ]
    },
    {
        "id": "aa679fe189fb4651",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "ввод данных",
        "func": "let id = 1,\n    subject_name = \"Системы искусственного интеллекта\",\n    title = \"Лабораторная работа №1\",\n    status = \"Не сдано\",\n    progress = 0,\n    comment = \"\",\n    task = \"<br />[[PYTHON]]\";\n\nmsg.topic = `insert into labs(id, subject_name, title, status, progress, comment, task) values ('${id}', '${subject_name}', '${title}', '${status}', '${progress}', '${comment}', '${task}')`;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 820,
        "wires": [
            [
                "c060d4599a37ba5f"
            ]
        ]
    },
    {
        "id": "c060d4599a37ba5f",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 590,
        "y": 820,
        "wires": [
            [
                "fced7c6a7b89032d"
            ]
        ]
    },
    {
        "id": "fced7c6a7b89032d",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 820,
        "wires": []
    },
    {
        "id": "415428279bb167f0",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "Вывод лаб",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 140,
        "y": 900,
        "wires": [
            [
                "bfdf81b6864d1335"
            ]
        ]
    },
    {
        "id": "bfdf81b6864d1335",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "fixed",
        "sql": "select * from labs",
        "name": "",
        "x": 330,
        "y": 900,
        "wires": [
            [
                "260af056ef3e2c3a"
            ]
        ]
    },
    {
        "id": "260af056ef3e2c3a",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 900,
        "wires": []
    },
    {
        "id": "324bea94568f0069",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "Удалить из БД",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "1",
        "x": 160,
        "y": 980,
        "wires": [
            [
                "ea97fab4d4c4715c"
            ]
        ]
    },
    {
        "id": "ea97fab4d4c4715c",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "Команда",
        "func": "if (msg.topic == \"all\") {\n    msg.topic = \"DELETE FROM labs\";\n}\nelse if (msg.topic){//удалить по id\n    msg.topic = `DELETE FROM labs WHERE id = '${msg.topic}'`;\n}\nelse {\n    msg.topic = \"SELECT 'msg.topic пуст' AS text\";\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 980,
        "wires": [
            [
                "8423d1604e4825e1"
            ]
        ]
    },
    {
        "id": "8423d1604e4825e1",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 530,
        "y": 980,
        "wires": [
            [
                "5bf97b91822d3be6"
            ]
        ]
    },
    {
        "id": "5bf97b91822d3be6",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 980,
        "wires": []
    },
    {
        "id": "2d3b30007ace24fa",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "Изменить задачу",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 1060,
        "wires": [
            [
                "b85fe9a5d218d2f2"
            ]
        ]
    },
    {
        "id": "b85fe9a5d218d2f2",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "ввод id и task",
        "func": "let task = `1. Начальные сведения о файловой системе Linux(часть 1).<br />\n2. Основы работы с файловой системой в командной оболочке.<br />\n3. Основы работы с компилятором gcc.<br />\n4. Системные вызовы и функции для работы с файловой системой.<br />\n<h3>Начальные сведения о файловой системе Linux (часть 1)</h3><br />\nВся информация, хранящаяся в компьютере, организована в файлы - именованные\nобласти данных на носителе информации. Также, во многих операционных системах (в том\nчисле в Linux) в виде работы с файлами организован и доступ к другим ресурсам, например,\nустройствам ввода-вывода.\nВсе файлы, доступные в операционной системе Linux, объединяются в единую\nдревовидную (имеющую вид направленного дерева – связного направленного графа без циклов)\nлогическую структуру. Ветками этого дерева (узлами, из которых могут исходить дуги)\nявляются специальные файлы, называемые директориями (каталогами, папками). Из них\nмогут исходить дуги к другим файлам - как к другим директориям, так и к файлам, хранящим\nразличные данные (регулярным файлам). Регулярные файлы являются листьями дерева -\nузлами, из которых не исходят дуги. Принято говорить, что директория включает в себя все\nфайлы, к которым из неё исходят дуги (или, что все такие файлы входят в данную\nдиректорию, находятся в данной директории).\nКаждому файлу (как регулярному, так и директории) должно быть присвоено имя. Оно не\nдолжно быть длиннее 255 символов (в других версиях 13 символов), не должно содержать\nсимвол с нулевым кодом (NUL) и символ ‘/’ (слэш). Также не рекомендуется использовать в\nименах файлов символы ‘*’, ‘?’, ‘\\’ (обратный слэш), кавычки и пробел. Файлы должны иметь\nуникальное имя в пределах той директории, в которую они входят. В отличие от Windows,\nLinux различает регистр символов, входящих в имя файла.\nОсобым случаем является корень дерева – единственная директория, не входящая ни в\nкакую другую. Её имя всегда «/» (единственное исключение из правила именования файлов).\nЕсли имя файла начинается с символа ‘.’, такой файл считается скрытым. <br /> [[PYTHON]] <br />`,\nid = 1;\nmsg.topic = `UPDATE labs\nSET task = '${task}'\nWHERE id = ${id};`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1060,
        "wires": [
            [
                "40bca252d5409afe"
            ]
        ]
    },
    {
        "id": "40bca252d5409afe",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 590,
        "y": 1060,
        "wires": [
            [
                "1425954943a3cbd3"
            ]
        ]
    },
    {
        "id": "1425954943a3cbd3",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 1060,
        "wires": []
    },
    {
        "id": "2d6773fcfdd5309f",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "Изменить статус",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 160,
        "y": 1120,
        "wires": [
            [
                "e4013aa985385184"
            ]
        ]
    },
    {
        "id": "e4013aa985385184",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "ввод id и task",
        "func": "let status = \"Сдано\",\nid = 2;\nmsg.topic = `UPDATE labs\nSET status = '${status}'\nWHERE id = ${id};`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 1120,
        "wires": [
            [
                "173749770eaef22b"
            ]
        ]
    },
    {
        "id": "173749770eaef22b",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 590,
        "y": 1120,
        "wires": [
            [
                "39a537873bcf5653"
            ]
        ]
    },
    {
        "id": "39a537873bcf5653",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "mes",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 1120,
        "wires": []
    },
    {
        "id": "e00aadd15fd5fb40",
        "type": "inject",
        "z": "96b3a7bdffc02a46",
        "g": "13fec579f68ce93d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 820,
        "wires": [
            [
                "aa679fe189fb4651"
            ]
        ]
    },
    {
        "id": "ecf716de61bc1a85",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "name": "получение данных пользователя",
        "func": "// Проверяем, что получили роль пользователя\nif (!msg.payload || msg.payload.length === 0) {\n    node.error(\"Не удалось получить данные пользователя\", msg);\n    return [null, msg];\n}\n\nconst userRole = msg.payload[0].role;\nmsg.userRole = userRole;\nconst userName = msg.payload[0].username;\nmsg.userName = userName;\nconst password = msg.payload[0].password;\nmsg.password = password;\nconst gruppa = msg.payload[0].gruppa;\nmsg.gruppa = gruppa;\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 180,
        "wires": [
            [
                "3043fb2166b3eba3"
            ]
        ]
    },
    {
        "id": "1463063b4c77a5db",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "select * from events",
        "name": "SQLite DB",
        "x": 350,
        "y": 180,
        "wires": [
            [
                "ecf716de61bc1a85"
            ]
        ]
    },
    {
        "id": "69c139b2d087a345",
        "type": "http in",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "url": "/labs",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 420,
        "wires": [
            [
                "d7a4dde06ee31064"
            ]
        ]
    },
    {
        "id": "d7a4dde06ee31064",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "добавление лабораторных",
        "func": "const labData = msg.payload;\nmsg.topic = `INSERT INTO labs(subject_name, title, status, progress, comment, task) \n             VALUES ('${labData.subject_name}', '${labData.title}', '${labData.status}', \n                    ${labData.progress}, '${labData.comment}', '${labData.task}')`;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 420,
        "wires": [
            [
                "e79d48ebdc349cdf"
            ]
        ]
    },
    {
        "id": "616e1cea6a58e185",
        "type": "http response",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 930,
        "y": 420,
        "wires": []
    },
    {
        "id": "725938fa0b6c40f3",
        "type": "http in",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "url": "/lab/:lab_id",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 480,
        "wires": [
            [
                "a519cd8a7f0eb26c"
            ]
        ]
    },
    {
        "id": "a519cd8a7f0eb26c",
        "type": "function",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "обновление лабораторных",
        "func": "const labId = msg.req.params.lab_id;\nconst labData = msg.payload;\nmsg.topic = `UPDATE labs \n             SET title = '${labData.title}', \n                 status = '${labData.status}', \n                 progress = ${labData.progress}, \n                 comment = '${labData.comment}', \n                 task = '${labData.task}'\n             WHERE id = ${labId}`;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 480,
        "wires": [
            [
                "b220638376516a8f"
            ]
        ]
    },
    {
        "id": "7071f2e33ed83996",
        "type": "http response",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 930,
        "y": 480,
        "wires": []
    },
    {
        "id": "e79d48ebdc349cdf",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "/*\nЗа раз можно сделать одну таблицу,\nпоэтому комментируй остальное\n */\nCREATE TABLE labs (\n    id INTEGER PRIMARY KEY,\n    subject_name TEXT,\n    title TEXT,\n    status TEXT,\n    message TEXT\n);",
        "name": "labs",
        "x": 770,
        "y": 420,
        "wires": [
            [
                "616e1cea6a58e185"
            ]
        ]
    },
    {
        "id": "b220638376516a8f",
        "type": "sqlite",
        "z": "96b3a7bdffc02a46",
        "g": "a18ab01cd2004dcd",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "/*\nЗа раз можно сделать одну таблицу,\nпоэтому комментируй остальное\n */\nCREATE TABLE labs (\n    id INTEGER PRIMARY KEY,\n    subject_name TEXT,\n    title TEXT,\n    status TEXT,\n    message TEXT\n);",
        "name": "labs",
        "x": 770,
        "y": 480,
        "wires": [
            [
                "7071f2e33ed83996"
            ]
        ]
    },
    {
        "id": "91d0af505d16a7c3",
        "type": "debug",
        "z": "96b3a7bdffc02a46",
        "g": "b83cceb90218bb16",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 160,
        "wires": []
    },
    {
        "id": "98a258e7e35f42a8",
        "type": "file in",
        "z": "96b3a7bdffc02a46",
        "name": "logo_osnovnoy.png ",
        "filename": "",
        "filenameType": "str",
        "format": "",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 970,
        "y": 620,
        "wires": [
            [
                "2085a41933487b98"
            ]
        ],
        "icon": "font-awesome/fa-image"
    },
    {
        "id": "2085a41933487b98",
        "type": "http response",
        "z": "96b3a7bdffc02a46",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1170,
        "y": 620,
        "wires": []
    },
    {
        "id": "953d496356877e9a",
        "type": "http in",
        "z": "96b3a7bdffc02a46",
        "name": "",
        "url": "/logo_osnovnoy.png",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 714.9999666213989,
        "y": 619.0000143051147,
        "wires": [
            [
                "98a258e7e35f42a8"
            ]
        ]
    },
    {
        "id": "031851d130f15efc",
        "type": "http in",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "Обработать вход",
        "url": "/login",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 600,
        "wires": [
            [
                "36a3ac2c32677eac"
            ]
        ]
    },
    {
        "id": "adc40443080e308e",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "Создать куку",
        "func": "const bcrypt = bcryptjs;\n\n// Проверяем существование пользователя\nif (!msg.payload || !msg.payload[0]) {\n    msg.error = \"Пользователь не найден\";\n    return [null, msg];\n}\n\nconst user = msg.payload[0];\n\n// Проверяем наличие пароля\nif (!user.password || typeof user.password !== 'string') {\n    msg.error = \"Некорректные данные пользователя\";\n    return [null, msg];\n}\n\ntry {\n    const match = await bcrypt.compare(msg.req.body.password, user.password);\n    \n    if (!match) {\n        msg.error = \"Неверный пароль\";\n        return [null, msg];\n    }\n\n    // Используем глобальные переменные Node-RED\n    const isProduction = env.get('NODE_ENV') === 'production';\n\n    // Успешная аутентификация\n    msg.cookies = {\n        \"auth_token\": {\n            value: \"generated_token_\" + Math.random().toString(36).slice(2, 11),\n            options: {\n                maxAge: 3600000,\n                httpOnly: true,\n                secure: isProduction\n            }\n        },\n        \"user_id\": {\n            value: user.id.toString(),\n            options: {\n                maxAge: 3600000,\n                httpOnly: true,\n                secure: isProduction\n            }\n        }\n    };\n    msg.headers = { \"Location\": \"/ssau\" };\n    msg.statusCode = 302;\n    return [msg, null];\n\n} catch (err) {\n    console.error(\"BCrypt Error:\", err);\n    msg.error = \"Ошибка при проверке пароля: \" + err.message;\n    return [null, msg];\n}",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "bcryptjs",
                "module": "bcryptjs"
            }
        ],
        "x": 860,
        "y": 600,
        "wires": [
            [
                "c27ea31347dad363",
                "2377d29ed80e9cf9"
            ],
            [
                "0b6d738d7e97f835",
                "2377d29ed80e9cf9"
            ]
        ]
    },
    {
        "id": "8669f4ba32fc71d4",
        "type": "http in",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "Показать форму входа",
        "url": "/login",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 540,
        "wires": [
            [
                "5b26c220827026c3"
            ]
        ]
    },
    {
        "id": "5b26c220827026c3",
        "type": "template",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "Страница входа",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n\n<head>\n    <title>Login</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 400px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n\n        .login-form {\n            background: #f9f9f9;\n            padding: 20px;\n            border-radius: 5px;\n        }\n\n        .form-group {\n            margin-bottom: 15px;\n        }\n\n        label {\n            display: block;\n            margin-bottom: 5px;\n        }\n\n        input[type=\"text\"],\n        input[type=\"password\"] {\n            width: 100%;\n            padding: 8px;\n            box-sizing: border-box;\n        }\n\n        button {\n            background: #4CAF50;\n            color: white;\n            padding: 10px 15px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n        }\n\n        .error {\n            color: red;\n            margin-top: 10px;\n        }\n        .register-link {\n            margin-top: 15px;\n            text-align: center;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"login-form\">\n        <h2>Авторизация</h2>\n        <form action=\"/login\" method=\"post\">\n            <div class=\"form-group\">\n                <label for=\"username\">Имя пользователя:</label>\n                <input type=\"text\" id=\"username\" name=\"username\" required>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"password\">Пароль:</label>\n                <input type=\"password\" id=\"password\" name=\"password\" required>\n            </div>\n            <button type=\"submit\">Авторизоваться</button>\n            {{#error}}<div class=\"error\">{{error}}</div>{{/error}}\n        </form>\n        <div class=\"register-link\">\n            <p>Нет аккаунта? <a href=\"/register\">Зарегистрируйтесь</a></p>\n        </div>\n    </div>\n</body>\n\n</html>",
        "x": 410,
        "y": 540,
        "wires": [
            [
                "c8c20f6a2c691098"
            ]
        ]
    },
    {
        "id": "c8c20f6a2c691098",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 610,
        "y": 540,
        "wires": []
    },
    {
        "id": "c27ea31347dad363",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1070,
        "y": 580,
        "wires": []
    },
    {
        "id": "0b6d738d7e97f835",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1070,
        "y": 640,
        "wires": []
    },
    {
        "id": "36a3ac2c32677eac",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "Команда",
        "func": "// Используем параметризованные запросы для защиты от SQL-инъекций\nconst insertSql = `SELECT * FROM users WHERE username = '${msg.payload.username}'`;\nmsg.topic = insertSql;\n//msg.topic = \"SELECT * FROM users WHERE username = ?\";\nmsg.params = [msg.payload.username];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 600,
        "wires": [
            [
                "97193aab93ec9e56"
            ]
        ]
    },
    {
        "id": "97193aab93ec9e56",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 610,
        "y": 600,
        "wires": [
            [
                "adc40443080e308e",
                "27c33b68edee51eb"
            ]
        ]
    },
    {
        "id": "27c33b68edee51eb",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 540,
        "wires": []
    },
    {
        "id": "2377d29ed80e9cf9",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "dc57bd4872fb081c",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 540,
        "wires": []
    },
    {
        "id": "ca6a824aa93cfae9",
        "type": "http in",
        "z": "d0d8641abf4dd3c2",
        "name": "Выход",
        "url": "/logout",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 1080,
        "wires": [
            [
                "4555e613e58ab10a"
            ]
        ]
    },
    {
        "id": "4555e613e58ab10a",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "name": "Обработать выход",
        "func": "msg.cookies = {\n    \"auth_token\": {\n        value: \"\",\n        options: {\n            expires: new Date(0) // Удаляем куку\n        }\n    },\n    \"user_id\": {\n        value: \"\",\n        options: {\n            expires: new Date(0) // Удаляем куку\n        }\n    }\n};\nmsg.headers = {\n    \"Location\": \"/login\"\n};\nmsg.statusCode = 302;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1080,
        "wires": [
            [
                "737925b2e1334d10"
            ]
        ]
    },
    {
        "id": "737925b2e1334d10",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 650,
        "y": 1080,
        "wires": []
    },
    {
        "id": "e7178670a25a18b8",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 770,
        "y": 780,
        "wires": []
    },
    {
        "id": "6b8f79edd8aac21d",
        "type": "template",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "Форма регистрации",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n\n<head>\n    <title>Регистрация</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n\n        .register-header {\n            text-align: center;\n            margin-bottom: 30px;\n        }\n\n        .register-container {\n            display: flex;\n            justify-content: space-between;\n            gap: 30px;\n        }\n\n        .register-form {\n            background: #f9f9f9;\n            padding: 20px;\n            border-radius: 5px;\n            flex: 1;\n        }\n\n        .form-group {\n            margin-bottom: 15px;\n        }\n\n        label {\n            display: block;\n            margin-bottom: 5px;\n        }\n\n        input[type=\"text\"],\n        input[type=\"password\"] {\n            width: 100%;\n            padding: 8px;\n            box-sizing: border-box;\n        }\n\n        button {\n            background: #4CAF50;\n            color: white;\n            padding: 10px 15px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            width: 100%;\n        }\n\n        .error {\n            color: red;\n            margin-top: 10px;\n        }\n\n        .login-link {\n            margin-top: 30px;\n            text-align: center;\n        }\n\n        .form-title {\n            text-align: right;\n            font-weight: bold;\n            margin-bottom: 15px;\n        }\n\n        .teacher-form .form-title {\n            text-align: left;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"register-header\">\n        <h2>Зарегистрироваться</h2>\n    </div>\n\n    <div class=\"register-container\">\n        <div class=\"register-form student-form\">\n            <div class=\"form-title\">Как студент</div>\n            <form action=\"/register/student\" method=\"post\">\n                <div class=\"form-group\">\n                    <label for=\"student_username\">Имя пользователя:</label>\n                    <input type=\"text\" id=\"student_username\" name=\"username\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"student_password\">Пароль:</label>\n                    <input type=\"password\" id=\"student_password\" name=\"password\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"student_gruppa\">Группа:</label>\n                    <input type=\"gruppa\" id=\"student_gruppa\" name=\"gruppa\" required>\n                </div>\n                <button type=\"submit\">Регистрация</button>\n                {{#student_error}}<div class=\"error\">{{student_error}}</div>{{/student_error}}\n            </form>\n        </div>\n\n        <div class=\"register-form teacher-form\">\n            <div class=\"form-title\">Как преподаватель</div>\n            <form action=\"/register/teacher\" method=\"post\">\n                <div class=\"form-group\">\n                    <label for=\"teacher_username\">Имя пользователя:</label>\n                    <input type=\"text\" id=\"teacher_username\" name=\"username\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"teacher_password\">Пароль:</label>\n                    <input type=\"password\" id=\"teacher_password\" name=\"password\" required>\n                </div>\n                <button type=\"submit\">Регистрация</button>\n                {{#teacher_error}}<div class=\"error\">{{teacher_error}}</div>{{/teacher_error}}\n            </form>\n        </div>\n    </div>\n\n    <div class=\"login-link\">\n        <p>Уже есть аккаунт? <a href=\"/login\">Войдите</a></p>\n    </div>\n</body>\n\n</html>",
        "x": 560,
        "y": 780,
        "wires": [
            [
                "e7178670a25a18b8"
            ]
        ]
    },
    {
        "id": "d1e1ee10de33ede4",
        "type": "http in",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "Показать форму регистрации",
        "url": "/register",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 250,
        "y": 780,
        "wires": [
            [
                "6b8f79edd8aac21d"
            ]
        ]
    },
    {
        "id": "3c9d1b24b24ae747",
        "type": "http in",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "Обработка регистрации студента",
        "url": "/register/student",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 840,
        "wires": [
            [
                "b1e0307f423abf6e"
            ]
        ]
    },
    {
        "id": "618bc6b82f23d01c",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "ввод данных",
        "func": "const bcrypt = bcryptjs;\nconst saltRounds = 10;\n//const node = this;\n\nif (msg.payload && msg.payload.length > 0) {\n    msg.error = \"Пользователь с таким именем уже существует\";\n    msg.payload = \"Ошибка: пользователь уже существует\";\n    msg.statusCode = 200;\n    return [null, msg];\n}\n\nreturn bcrypt.hash(msg.password, saltRounds)\n    .then(hashedPassword => {\n        const insertSql = `INSERT INTO users (username, password, gruppa, role) VALUES ('${msg.username}', '${hashedPassword}', '${msg.gruppa}', '${msg.role}')`;\n        msg.topic = insertSql;\n        msg.params = [msg.username, hashedPassword, msg.gruppa, msg.role];\n        msg.headers = {\n            \"Location\": \"/login\"\n        };\n        msg.statusCode = 302;\n        return [msg, null];\n    })\n    .catch(err => {\n        //node.error(err, msg);\n        msg.error = \"Ошибка при создании пользователя\";\n        return [null, msg];\n    });",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "bcryptjs",
                "module": "bcryptjs"
            }
        ],
        "x": 960,
        "y": 840,
        "wires": [
            [
                "b76e496ea8b8958c"
            ],
            [
                "b49a245a351586b4"
            ]
        ]
    },
    {
        "id": "b76e496ea8b8958c",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 1200,
        "y": 840,
        "wires": [
            [
                "c8c7b346cb27b9aa"
            ]
        ]
    },
    {
        "id": "b1e0307f423abf6e",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "Команда",
        "func": "// Используем параметризованные запросы для защиты от SQL-инъекций\nmsg.topic = \"SELECT * FROM users WHERE username = ?\";\nmsg.params = [msg.payload.username];\nmsg.username = msg.payload.username;\nmsg.password = msg.payload.password;\nmsg.gruppa = msg.payload.gruppa;\nmsg.role = \"student\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 840,
        "wires": [
            [
                "dae4ea71260b3920"
            ]
        ]
    },
    {
        "id": "dae4ea71260b3920",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 740,
        "y": 840,
        "wires": [
            [
                "618bc6b82f23d01c"
            ]
        ]
    },
    {
        "id": "b49a245a351586b4",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1150,
        "y": 900,
        "wires": []
    },
    {
        "id": "c8c7b346cb27b9aa",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1430,
        "y": 840,
        "wires": []
    },
    {
        "id": "31e15ad0550e236f",
        "type": "http in",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "Обработка регистрации преподавателя",
        "url": "/register/teacher",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 280,
        "y": 940,
        "wires": [
            [
                "10cd1b14c7995373"
            ]
        ]
    },
    {
        "id": "8f4fbb8f32372c69",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "ввод данных",
        "func": "const bcrypt = bcryptjs;\nconst saltRounds = 10;\n//const node = this;\n\nif (msg.payload && msg.payload.length > 0) {\n    msg.error = \"Пользователь с таким именем уже существует\";\n    msg.payload = \"Ошибка: пользователь уже существует\";\n    msg.statusCode = 200;\n    return [null, msg];\n}\n\nreturn bcrypt.hash(msg.password, saltRounds)\n    .then(hashedPassword => {\n        const insertSql = `INSERT INTO users (username, password, gruppa, role) VALUES ('${msg.username}', '${hashedPassword}', '${msg.gruppa}', '${msg.role}')`;\n        msg.topic = insertSql;\n        msg.params = [msg.username, hashedPassword, msg.gruppa, msg.role];\n        msg.headers = {\n            \"Location\": \"/login\"\n        };\n        msg.statusCode = 302;\n        return [msg, null];\n    })\n    .catch(err => {\n        //node.error(err, msg);\n        msg.error = \"Ошибка при создании пользователя\";\n        return [null, msg];\n    });",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "bcryptjs",
                "module": "bcryptjs"
            }
        ],
        "x": 960,
        "y": 940,
        "wires": [
            [
                "c203fc9c1159ab64"
            ],
            [
                "9370873a09365f55"
            ]
        ]
    },
    {
        "id": "c203fc9c1159ab64",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 1200,
        "y": 940,
        "wires": [
            [
                "d40d83bd0ca25087"
            ]
        ]
    },
    {
        "id": "10cd1b14c7995373",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "Команда",
        "func": "// Используем параметризованные запросы для защиты от SQL-инъекций\nmsg.topic = \"SELECT * FROM users WHERE username = ?\";\nmsg.params = [msg.payload.username];\nmsg.username = msg.payload.username;\nmsg.password = msg.payload.password;\nmsg.gruppa = \"teacher\";\nmsg.role = \"teacher\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 940,
        "wires": [
            [
                "da9b55839080b175"
            ]
        ]
    },
    {
        "id": "da9b55839080b175",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 740,
        "y": 940,
        "wires": [
            [
                "8f4fbb8f32372c69"
            ]
        ]
    },
    {
        "id": "9370873a09365f55",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1150,
        "y": 1000,
        "wires": []
    },
    {
        "id": "d40d83bd0ca25087",
        "type": "http response",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1430,
        "y": 940,
        "wires": []
    },
    {
        "id": "ff034c38362a0987",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "498fbf74c49afb10",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1330,
        "y": 900,
        "wires": []
    },
    {
        "id": "443cd013942e049b",
        "type": "inject",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Инициализация БД",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 210,
        "y": 60,
        "wires": [
            [
                "07502029eb702eb5"
            ]
        ]
    },
    {
        "id": "07502029eb702eb5",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Создать таблицу users",
        "func": "// Создаем таблицу пользователей, если она не существует\nconst sql = `CREATE TABLE IF NOT EXISTS users (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    username TEXT UNIQUE NOT NULL,\n    password TEXT NOT NULL,\n    gruppa TEXT NOT NULL,\n    role TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n)`;\n\nmsg.topic = sql;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 60,
        "wires": [
            [
                "0e83a3bbd8e179e9"
            ]
        ]
    },
    {
        "id": "0e83a3bbd8e179e9",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "mydb": "d3f44785a6cfb327",
        "sql": "",
        "name": "SQLite DB",
        "x": 710,
        "y": 60,
        "wires": [
            [
                "c63632fc28ce11a6"
            ]
        ]
    },
    {
        "id": "c63632fc28ce11a6",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 60,
        "wires": []
    },
    {
        "id": "b6ff6bf0a2db0f73",
        "type": "inject",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Вывод таблиц БД",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SELECT name FROM sqlite_master WHERE type='table';",
        "x": 210,
        "y": 120,
        "wires": [
            [
                "1817f3efaa191a75"
            ]
        ]
    },
    {
        "id": "76611972ca3c4eea",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 120,
        "wires": []
    },
    {
        "id": "1817f3efaa191a75",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "SQLite DB",
        "x": 450,
        "y": 120,
        "wires": [
            [
                "76611972ca3c4eea"
            ]
        ]
    },
    {
        "id": "3624767e91f5e2c5",
        "type": "inject",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Вывод пользователей",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 220,
        "y": 180,
        "wires": [
            [
                "372f518119c12c96"
            ]
        ]
    },
    {
        "id": "0452e331b7f0d51e",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "все пользователи",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 180,
        "wires": []
    },
    {
        "id": "372f518119c12c96",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "fixed",
        "sql": "select * from users",
        "name": "SQLite DB",
        "x": 450,
        "y": 180,
        "wires": [
            [
                "0452e331b7f0d51e"
            ]
        ]
    },
    {
        "id": "607b053169d04a43",
        "type": "inject",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Создание пользователя",
        "props": [
            {
                "p": "msg.payload.username",
                "v": "admin22",
                "vt": "str"
            },
            {
                "p": "msg.payload.password",
                "v": "12322",
                "vt": "str"
            },
            {
                "p": "msg.payload.gruppa",
                "v": "teacher",
                "vt": "str"
            },
            {
                "p": "msg.payload.role",
                "v": "teacher",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "x": 230,
        "y": 240,
        "wires": [
            [
                "87fd58b7ed0389d1"
            ]
        ]
    },
    {
        "id": "87fd58b7ed0389d1",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "ввод данных",
        "func": "const insertSql = `INSERT INTO users (username, password, gruppa, role) VALUES ('${msg.payload.username}', '${msg.payload.password}', '${msg.payload.gruppa}', '${msg.payload.role}')`;\nmsg.topic = insertSql;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 240,
        "wires": [
            [
                "eafb07e8b93f3ac6"
            ]
        ]
    },
    {
        "id": "eafb07e8b93f3ac6",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 730,
        "y": 240,
        "wires": [
            [
                "90e9e2d1f7f9d36a"
            ]
        ]
    },
    {
        "id": "90e9e2d1f7f9d36a",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 240,
        "wires": []
    },
    {
        "id": "89842634261a77ac",
        "type": "inject",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Удалить из БД",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "2",
        "x": 200,
        "y": 300,
        "wires": [
            [
                "c7b205b79a37f418"
            ]
        ]
    },
    {
        "id": "c7b205b79a37f418",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Команда",
        "func": "if (msg.topic == \"all\") {\n    msg.topic = \"DELETE FROM users\";\n}\nelse if (msg.topic){//удалить по id\n    msg.topic = `DELETE FROM users WHERE id = '${msg.topic}'`;\n}\nelse {\n    msg.topic = \"SELECT 'msg.topic пуст' AS text\";\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 300,
        "wires": [
            [
                "d6d068aaeeea77ab"
            ]
        ]
    },
    {
        "id": "7f6525641d53d94a",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 300,
        "wires": []
    },
    {
        "id": "d6d068aaeeea77ab",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 730,
        "y": 300,
        "wires": [
            [
                "7f6525641d53d94a"
            ]
        ]
    },
    {
        "id": "7edf5bacb90fb74f",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Команда",
        "func": "const insertSql = `SELECT * FROM users WHERE username = '${msg.payload.username}'AND password = '${msg.payload.password}'`;\nmsg.topic = insertSql;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 360,
        "wires": [
            [
                "05b8799d743f5910"
            ]
        ]
    },
    {
        "id": "d9a8de37694d2f8f",
        "type": "debug",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 950,
        "y": 360,
        "wires": []
    },
    {
        "id": "05b8799d743f5910",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 730,
        "y": 360,
        "wires": [
            [
                "d9a8de37694d2f8f"
            ]
        ]
    },
    {
        "id": "fbb421f7dbfb0684",
        "type": "inject",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Найти пользователя",
        "props": [
            {
                "p": "msg.payload.username",
                "v": "admin",
                "vt": "str"
            },
            {
                "p": "msg.payload.password",
                "v": "123",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "x": 220,
        "y": 360,
        "wires": [
            [
                "7edf5bacb90fb74f"
            ]
        ]
    },
    {
        "id": "680c496ed65e1fd7",
        "type": "inject",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Удалить из БД",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 200,
        "y": 420,
        "wires": [
            [
                "e1fb6ce89826a9dc"
            ]
        ]
    },
    {
        "id": "e1fb6ce89826a9dc",
        "type": "function",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "name": "Команда",
        "func": "msg.topic = \"DROP TABLE users\";\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 420,
        "wires": [
            [
                "302c954ed4b68337"
            ]
        ]
    },
    {
        "id": "302c954ed4b68337",
        "type": "sqlite",
        "z": "d0d8641abf4dd3c2",
        "g": "08dea3c2803be79b",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 720,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "91454e29df862af1",
        "type": "http in",
        "z": "8cd62b9679ad11ce",
        "name": "",
        "url": "/messenger",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 80,
        "wires": [
            [
                "896a12680931337c"
            ]
        ]
    },
    {
        "id": "9647228e347af4de",
        "type": "template",
        "z": "8cd62b9679ad11ce",
        "name": "Внешний вид списка чатов",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Активные чаты</title>\n    <link rel=\"icon\" type=\"image/png\" href=\"https://cabinet.ssau.ru/asset/favicon.ico\">\n    <style>\n        {{{cssText}}}\n    </style>\n    <style>\n        /* Дополнительные стили для этой страницы */\n        .main_content {\n            margin-left: 100px; /* Уменьшаем отступ, чтобы боковое меню было лучше видно */\n            display: grid;\n            grid-template-columns: 1fr 2fr; /*  Две колонки: для списка и для чата */\n            gap: 20px; /* Отступ между колонками */\n        }\n\n        .dialog-list-container {\n            /*  Контейнер для списка диалогов */\n        }\n\n        .dialog-list {\n            list-style: none;\n            padding: 0;\n            margin: 20px 0;\n        }\n\n        .dialog-item {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n            border-bottom: 1px solid #eee;\n            cursor: pointer;\n            background-color: #fff;\n        }\n\n        .dialog-item:hover {\n            background-color: #f9f9f9;\n        }\n\n        .dialog-icon {\n            width: 30px;\n            height: 30px;\n            margin-right: 10px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n        }\n\n        .dialog-icon.tz {\n            background-color: #0D47A1; /* Цвет для иконки \"ТЗ\" */\n        }\n\n        .dialog-icon.chat {\n            background-color: #1D5DEB; /* Цвет для иконки чата */\n        }\n\n        .dialog-text {\n            flex-grow: 1;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n\n        .chat-view {\n            display: none;\n            margin-top: 20px;\n            background-color: #fff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n            border-radius: 5 px;\n        }\n\n        .chat-view.active {\n            display: block;\n        }\n\n        #searchBar {\n            width: 100%;\n            padding: 10px;\n            margin-bottom: 10px;\n            border: 1px solid #ccc;\n            border-radius: 5px;\n            box-sizing: border-box;\n        }\n\n        .hidden {\n            display: none;\n        }\n\n        .chat-messages {\n            height: 300px;\n            overflow-y: scroll;\n            padding: 10px;\n            border: 1px solid #ddd;\n            margin-bottom: 10px;\n        }\n\n        .message {\n            padding: 8px 12px;\n            margin-bottom: 5px;\n            border-radius: 5px;\n            background-color: #f0f0f0;\n        }\n\n        .input-area {\n            display: flex;\n            align-items: center;\n        }\n\n        .input-area input {\n            flex-grow: 1;\n            padding: 8px;\n            border: 1px solid #ddd;\n            border-radius: 5px;\n        }\n\n        .input-area button {\n            padding: 8px 12px;\n            margin-left: 5px;\n            border: none;\n            border-radius: 5px;\n            background-color: #007bff;\n            color: white;\n            cursor: pointer;\n        }\n\n        .input-area button:hover {\n            background-color: #0056b3;\n        }\n    </style>\n</head>\n<body>\n\n<header class=\"topbar\">\n    <div class=\"divlogoname\"><img\n            src=\"https://sun9-71.userapi.com/impg/5bKKjXmZHXD-py_TrIJPKFRQ7bS0QHjZuGtpmw/76Nc37KiTHI.jpg?size=1890x185&quality=95&sign=f3cefb5512a49c2d843e894fda497b97&type=album\"\n            class=\"logoname\"></div>\n</header>\n\n<div class=\"sidebar\" id=\"sidebar\">\n    <div class=\"logocenter\" id=\"logocenter\">\n        <img\n                src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png\"\n                class=\"logo\" id=\"logo\">\n    </div>\n    <button class=\"toggle-btn\" id=\"toggleBtn\">\n        <img src=\"https://github.com/Kulakov1Dima/SsauWorkspace/blob/main/hahaton_exemple_fronted/expand.png?raw=true\">\n    </button>\n    <ul class=\"menu\" id=\"menu\">\n        <li>\n            <img\n                    src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/home1.png\"\n                    class=\"icon\">\n            <span class=\"text\">Главная</span>\n        </li>\n        <li onclick=\"location.href='http://localhost:1880/messenger';\" style=\"cursor:pointer;\">\n            <img\n                    src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/messenger.png\"\n                    class=\"icon\">\n            <span class=\"text\">Мессенджер</span>\n        </li>\n        <li onclick=\"location.href='http://localhost:1880/ssau';\" style=\"cursor:pointer;\">\n            <img                     src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/schedule.png\"\n            class=\"icon\">\n    <span class=\"text\">Расписание</span>\n</li>\n</ul>\n</div>\n\n<div class=\"main_content\">\n\n<div class=\"dialog-list-container\">\n<h2>Активные чаты</h2>\n<input type=\"text\" id=\"searchBar\" placeholder=\"Поиск...\">\n<ul class=\"dialog-list\" id=\"dialogList\">\n</ul>\n</div>\n\n<div id=\"chatView\" class=\"chat-view\">\n<h3>Название чата</h3>\n<div class=\"chat-messages\">\n    <!-- Сообщения чата будут здесь -->\n    <div class=\"message\"></div>\n    <div class=\"message\"></div>\n</div>\n<div class=\"input-area\">\n    <input type=\"text\" placeholder=\"Сообщение...\">\n    <button>Отправить</button>\n</div>\n</div>\n\n</div>\n\n<script>\n    const imagesToPreload = [\n    \"http://localhost:1880/logo_osnovnoy.png\",\n    \"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png\"\n];\n\nimagesToPreload.forEach(src => {\n    const img = new Image();\n    img.src = src;\n});\n\nconst sidebar = document.getElementById('sidebar');\nconst toggleBtn = document.getElementById('toggleBtn');\nconst logo = document.getElementById('logo');\nconst logocenter = document.getElementById('logocenter');\nconst menu = document.getElementById('menu');\n\ntoggleBtn.addEventListener('click', () => {\n    if (!toggleBtn.classList.contains('expanded1')) {\n        toggleBtn.classList.add('expanded1');\n        sidebar.classList.add('expanded1');\n    } else {\n        toggleBtn.classList.remove('expanded1');\n        sidebar.classList.remove('expanded1');\n    }\n});\n\nsidebar.addEventListener('mouseenter', () => {\n    logo.src = 'http://localhost:1880/logo_osnovnoy.png';\n    logo.classList.add('small');\n    logocenter.classList.add('small');\n    menu.classList.add('small');\n});\n\nsidebar.addEventListener('mouseleave', () => {\n    if (!sidebar.classList.contains('expanded1')) {\n        logo.src = 'https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png';\n        logo.classList.remove('small');\n        logocenter.classList.remove('small');\n        menu.classList.remove('small');\n    }\n});\n\ndocument.addEventListener('DOMContentLoaded', function () {\n    const dialogList = document.getElementById('dialogList');\n    const chatView = document.getElementById('chatView');\n    const searchBar = document.getElementById('searchBar');\n    const chatMessages = chatView.querySelector('.chat-messages');\n    const messageInput = chatView.querySelector('input');\n    const sendButton = chatView.querySelector('button');\n\n    let currentChat = null;\n    let refreshInterval = null;\n\n    const dialogs = [\n        {\n            type: 'tz',\n            name: 'Использование Linux',\n            url: 'https://localhost:1880/subject?name=Использование%20Linux'\n        },\n        {\n            type: 'chat',\n            name: 'Использование Linux | Чат',\n            chatname: 'Использование Linux'\n        },\n        {\n            type: 'tz',\n            name: 'Системное программирование',\n            url: 'https://localhost:1880/subject?name=Системное%20программирование'\n        },\n        {\n            type: 'chat',\n            name: 'Системное программирование | Чат',\n            chatname: 'Системное программирование'\n        },\n        {\n            type: 'tz',\n            name: 'Системы искусственного интеллекта',\n            url: 'https://localhost:1880/subject?name=Системы%20искусственного%20интеллекта'\n        },\n        {\n            type: 'chat',\n            name: 'Системы искусственного интеллекта | Чат',\n            chatname: 'Системы искусственного интеллекта'\n        },\n        {\n            type: 'tz',\n            name: 'Технологии проектирования',\n            url: 'https://localhost:1880/subject?name=Технологии%20проектирования'\n        }\n    ];\n\n    function displayDialogs(dialogsToDisplay) {\n        dialogList.innerHTML = '';\n\n        dialogsToDisplay.forEach(dialog => {\n            const li = document.createElement('li');\n            li.classList.add('dialog-item');\n            li.dataset.type = dialog.type;\n            li.dataset.name = dialog.name;\n\n            let iconText = '';\n            let iconClass = '';\n\n            if (dialog.type === 'tz') {\n                iconText = 'ТЗ';\n                iconClass = 'tz';\n                li.addEventListener('click', () => {\n                    stopAutoRefresh();\n                    window.location.href = dialog.url;\n                });\n            } else if (dialog.type === 'chat') {\n                iconText = '<i class=\"fas fa-users\"></i>';\n                iconClass = 'chat';\n                li.addEventListener('click', () => {\n                    if (currentChat !== dialog.chatname) {\n                        stopAutoRefresh();\n                        currentChat = dialog.chatname;\n                        displayChat(dialog.name);\n                        loadChatMessages(dialog.chatname);\n                        startAutoRefresh();\n                    }\n                });\n            }\n\n            li.innerHTML = `\n                <div class=\"dialog-icon ${iconClass}\">${iconText}</div>\n                <div class=\"dialog-text\">${dialog.name}</div>\n            `;\n\n            dialogList.appendChild(li);\n        });\n    }\n\n    function stopAutoRefresh() {\n        if (refreshInterval) {\n            clearInterval(refreshInterval);\n            refreshInterval = null;\n        }\n    }\n\n    function startAutoRefresh() {\n        stopAutoRefresh(); // Остановить предыдущий интервал, если был\n        refreshInterval = setInterval(() => {\n            if (currentChat) {\n                loadChatMessages(currentChat);\n            }\n        }, 3000); // Обновление каждые 3 секунды\n    }\n\n    function displayChat(chatName) {\n        chatView.querySelector('h3').textContent = chatName;\n        chatView.classList.add('active');\n    }\n\n    function loadChatMessages(chatname) {\n        fetch(`/get-chat-messages?chatname=${encodeURIComponent(chatname)}`)\n            .then(response => response.json())\n            .then(messages => {\n                renderMessages(messages);\n            })\n            .catch(error => {\n                console.error('Ошибка при загрузке сообщений:', error);\n            });\n    }\n\n    function renderMessages(messages) {\n        // Всегда очищаем чат перед рендерингом\n        chatMessages.innerHTML = '';\n\n        if (!messages || messages.length === 0) {\n            // Показываем \"Нет сообщений\" только если чат действительно пуст\n            // и это не результат только что отправленного сообщения\n            if (!messageInput.value.trim()) { // Проверяем, что мы не в процессе отправки\n                chatMessages.innerHTML = '<div class=\"message\">Нет сообщений</div>';\n            }\n            return;\n        }\n\n        messages.forEach(message => {\n            const messageDiv = document.createElement('div');\n            messageDiv.classList.add('message');\n\n            if (message.gruppa === 'teacher') {\n                messageDiv.classList.add('teacher-message');\n            }\n        \n            messageDiv.innerHTML = `\n                <strong>${message.username}</strong>:\n                ${message.text}\n                <div class=\"message-time\">${new Date(message.created_at).toLocaleTimeString()}</div>\n            `;\n            chatMessages.appendChild(messageDiv);\n        });\n\n        chatMessages.scrollTop = chatMessages.scrollHeight;\n    }\n\n    function sendMessage() {\n        const text = messageInput.value.trim();\n        if (!text || !currentChat) return;\n\n        fetch('/send-message', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n                chatname: currentChat,\n                text: text\n            })\n        })\n        .then(response => {\n            if (response.ok) {\n                messageInput.value = '';\n                // Принудительно очищаем чат перед загрузкой новых сообщений\n                chatMessages.innerHTML = '';\n                loadChatMessages(currentChat);\n            }\n        })\n        .catch(error => {\n            console.error('Ошибка при отправке сообщения:', error);\n        });\n    }\n\n    searchBar.addEventListener('input', function (e) {\n        const searchTerm = e.target.value.toLowerCase();\n        const filteredDialogs = dialogs.filter(dialog => {\n            return dialog.name.toLowerCase().includes(searchTerm);\n        });\n        displayDialogs(filteredDialogs);\n    });\n\n    sendButton.addEventListener('click', sendMessage);\n    messageInput.addEventListener('keypress', function (e) {\n        if (e.key === 'Enter') {\n            sendMessage();\n        }\n    });\n\n    displayDialogs(dialogs);\n});\n</script>\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" integrity=\"sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\n</body>\n</html>\n",
        "output": "str",
        "x": 920,
        "y": 80,
        "wires": [
            [
                "f867e8a8395f63a4"
            ]
        ],
        "icon": "node-red/parser-html.svg"
    },
    {
        "id": "f867e8a8395f63a4",
        "type": "http response",
        "z": "8cd62b9679ad11ce",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1130,
        "y": 80,
        "wires": []
    },
    {
        "id": "896a12680931337c",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "name": "Проверка авторизации",
        "func": "// Проверяем куки\nif (!msg.req.cookies || !msg.req.cookies.auth_token) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\n// Получаем ID пользователя из куки\nconst userId = msg.req.cookies.user_id;\nif (!userId) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\nmsg.topic = `SELECT role, username FROM users WHERE id = '${userId}'`;\nmsg.userId = userId;\n// Здесь можно добавить проверку валидности токена\n// Например, сравнить с хранящимся в памяти или БД\n\nreturn [msg, null];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 80,
        "wires": [
            [
                "5cae1dc872a4769e"
            ],
            [
                "f867e8a8395f63a4"
            ]
        ]
    },
    {
        "id": "78f98ed8537f4b31",
        "type": "inject",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Инициализация БД",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 250,
        "y": 360,
        "wires": [
            [
                "7a89d7535010efb2"
            ]
        ]
    },
    {
        "id": "7a89d7535010efb2",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Создать таблицу messages",
        "func": "// Создаем таблицу сообщений, если она не существует\nconst sql = `CREATE TABLE IF NOT EXISTS messages (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    chatname TEXT NOT NULL,\n    username TEXT NOT NULL,\n    text TEXT NOT NULL,\n    gruppa TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n)`;\n\nmsg.topic = sql;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 360,
        "wires": [
            [
                "36386a2733d98b70"
            ]
        ]
    },
    {
        "id": "36386a2733d98b70",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "mydb": "d3f44785a6cfb327",
        "sql": "",
        "name": "SQLite DB",
        "x": 750,
        "y": 360,
        "wires": [
            [
                "ed89fe60e9d7c467"
            ]
        ]
    },
    {
        "id": "ed89fe60e9d7c467",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 940,
        "y": 360,
        "wires": []
    },
    {
        "id": "28dae3d0cb6655d8",
        "type": "inject",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Вывод таблиц БД",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SELECT name FROM sqlite_master WHERE type='table';",
        "x": 250,
        "y": 420,
        "wires": [
            [
                "31f240fb5e34c6ec"
            ]
        ]
    },
    {
        "id": "a031472365e48814",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 420,
        "wires": []
    },
    {
        "id": "31f240fb5e34c6ec",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "SQLite DB",
        "x": 490,
        "y": 420,
        "wires": [
            [
                "a031472365e48814"
            ]
        ]
    },
    {
        "id": "c4ce28bbe2d59123",
        "type": "inject",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Вывод сообщений",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 250,
        "y": 480,
        "wires": [
            [
                "bbb778ecb3facdf4"
            ]
        ]
    },
    {
        "id": "57d2671daa8fefc1",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "все сообщения",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 480,
        "wires": []
    },
    {
        "id": "bbb778ecb3facdf4",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "fixed",
        "sql": "select * from messages",
        "name": "SQLite DB",
        "x": 490,
        "y": 480,
        "wires": [
            [
                "57d2671daa8fefc1"
            ]
        ]
    },
    {
        "id": "36e9e80567617f4d",
        "type": "inject",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Создание сообшения",
        "props": [
            {
                "p": "msg.payload.chatname",
                "v": "Системы искусственного интеллекта",
                "vt": "str"
            },
            {
                "p": "msg.payload.username",
                "v": "Солдатова Ольга Петровна",
                "vt": "str"
            },
            {
                "p": "msg.payload.gruppa",
                "v": "teacher",
                "vt": "str"
            },
            {
                "p": "msg.payload.text",
                "v": "Экзамен завтра в 16:00",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "x": 260,
        "y": 540,
        "wires": [
            [
                "b46a07e5bed22e6c"
            ]
        ]
    },
    {
        "id": "b46a07e5bed22e6c",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "ввод данных",
        "func": "const insertSql = `INSERT INTO events (chatname, username, text, gruppa) VALUES ('${msg.payload.chatname}', '${msg.payload.username}', '${msg.payload.text}', '${msg.payload.gruppa}')`;\nmsg.topic = insertSql;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 540,
        "wires": [
            [
                "6615d5887534ac85"
            ]
        ]
    },
    {
        "id": "6615d5887534ac85",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 770,
        "y": 540,
        "wires": [
            [
                "66a4d0f8b9d0badf"
            ]
        ]
    },
    {
        "id": "66a4d0f8b9d0badf",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 540,
        "wires": []
    },
    {
        "id": "dfb926319df5112a",
        "type": "inject",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Удалить из БД",
        "props": [
            {
                "p": "topic.date",
                "v": "2025-05-20",
                "vt": "str"
            },
            {
                "p": "topic.time",
                "v": "09:45 - 11:20",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 240,
        "y": 600,
        "wires": [
            [
                "dc52fc295be87803"
            ]
        ]
    },
    {
        "id": "dc52fc295be87803",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Команда",
        "func": "if (msg.topic == \"all\") {\n    msg.topic = \"DELETE FROM messages\";\n}\nelse if (msg.topic){//удалить по id\n    msg.topic = `DELETE FROM messages WHERE id = '${msg.topic.id}'`;\n}\nelse {\n    msg.topic = \"SELECT 'msg.topic пуст' AS text\";\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 600,
        "wires": [
            [
                "d1204b1faf51d6c4"
            ]
        ]
    },
    {
        "id": "a63b5d1a5f774d98",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 600,
        "wires": []
    },
    {
        "id": "d1204b1faf51d6c4",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 770,
        "y": 600,
        "wires": [
            [
                "a63b5d1a5f774d98"
            ]
        ]
    },
    {
        "id": "954ccfcc18f82b4e",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Команда",
        "func": "const insertSql = `SELECT * FROM messages WHERE chatname = '${msg.payload.chatname}'`;\nmsg.topic = insertSql;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 660,
        "wires": [
            [
                "1568bd5286e59760"
            ]
        ]
    },
    {
        "id": "16aed3ba96a53f69",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 660,
        "wires": []
    },
    {
        "id": "1568bd5286e59760",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 770,
        "y": 660,
        "wires": [
            [
                "16aed3ba96a53f69"
            ]
        ]
    },
    {
        "id": "f21aaa2a0d85371c",
        "type": "inject",
        "z": "8cd62b9679ad11ce",
        "g": "a9b84b854e281eb5",
        "name": "Найти сообщение",
        "props": [
            {
                "p": "msg.payload.date",
                "v": "2025-05-20",
                "vt": "str"
            },
            {
                "p": "msg.payload.time",
                "v": "09:45 - 11:20",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "x": 250,
        "y": 660,
        "wires": [
            [
                "954ccfcc18f82b4e"
            ]
        ]
    },
    {
        "id": "8accc27ec328375d",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "name": "css",
        "func": "var css = `\nbody {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 0;\n            height: 1200px;\n            background-color: #edf3fec1;\n        }\n\n        .topbar {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 80px;\n            background-color: #fff;\n            color: white;\n            display: flex;\n            align-items: center;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding-left: 20px;\n            z-index: 1;\n        }\n\n\n        .sidebar {\n            width: 45px;\n            height: 100%;\n            background-color: #fff;\n            color: white;\n            position: fixed;\n            top: 0;\n            left: 0;\n            transition: width 0.3s;\n            overflow: visible;\n            white-space: nowrap;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 10px;\n            z-index: 10;\n        }\n\n        .sidebar.expanded1 {\n            width: 340px;\n            transition: width 0.7s ease;\n        }\n\n        .sidebar:hover {\n            width: 340px;\n            transition: width 0.7s ease;\n        }\n\n        .toggle-btn {\n            cursor: pointer;\n            text-align: center;\n            padding: 10px;\n            background-color: #EDF3FE;\n            border: none;\n            color: white;\n            width: 33px;\n            height: 33px;\n            border-radius: 50%;\n            outline: none;\n            position: absolute;\n            left: 82%;\n            top: 40px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 10px;\n        }\n\n        .toggle-btn.expanded1 {\n            transform: rotate(180deg);\n        }\n\n        .toggle-btn img {\n            width: 100%;\n            height: 100%;\n            object-fit: contain;\n            display: block;\n            transition: transform 0.2s ease;\n        }\n\n        .button-list {\n            list-style-type: none;\n            padding: 0;\n            margin: 0;\n        }\n\n        .button-list li {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n        }\n\n        .button-list li img {\n            width: 24px;\n            height: 24px;\n            margin-right: 10px;\n        }\n\n        .button-list li:hover {\n            background-color: #555;\n        }\n\n        .text {\n            display: none;\n        }\n\n        .sidebar.expanded .text {\n            display: inline;\n        }\n\n        .sidebar:hover .text {\n            display: inline;\n        }\n\n        .logo {\n            width: 30px;\n            height: auto;\n            left: 84%;\n        }\n\n        .logo.small {\n            width: 300px;\n            height: auto;\n            transition: width 0.5s ease;\n        }\n\n        .logocenter {\n            border: 5px solid;\n            position: absolute;\n            top: 45px;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            padding: 10px;\n        }\n\n        .logocenter.small {\n            border: 6px solid;\n            position: absolute;\n            top: 110px;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            padding: 10px;\n        }\n\n        .logoname {\n            width: 230px;\n            height: auto;\n        }\n\n        .divlogoname {\n            height: auto;\n            position: absolute;\n            top: 20px;\n            left: 80px;\n            padding: 10px;\n        }\n\n        .menu {\n            list-style: none;\n            position: absolute;\n            color: black;\n            top: 60px;\n            width: 95%;\n            padding: 0;\n            margin: 40px 0 0 0;\n            transition: transform 0.7s ease;\n        }\n\n        .menu.small {\n            list-style: none;\n            position: absolute;\n            color: black;\n            top: 170px;\n            width: 95%;\n            padding: 0;\n            margin: 40px 0 0 0;\n        }\n\n        .menu li {\n            display: flex;\n            align-items: center;\n            padding: 12px;\n            cursor: pointer;\n            transition: background 0.6s;\n        }\n\n        .menu li:hover {\n            background: #EDF3FE;\n        }\n\n        .icon {\n            width: 24px;\n            height: 24px;\n            margin-right: 40px;\n        }\n\n        .text {\n            display: inline-block;\n            opacity: 0;\n            transition: opacity 0.3s ease 0.8s;\n            font-size: 18px;\n        }\n\n        .sidebar:not(.expanded1) .menu li,\n        .sidebar:hover:not(.expanded1) .menu li {\n            justify-content: left;\n        }\n\n        .sidebar:not(.expanded1) .text {\n            opacity: 0;\n            visibility: hidden;\n        }\n\n        .sidebar.expanded1 .menu li,\n        .sidebar:hover .menu li {\n\n            ustify-content: flex-start;\n            padding-left: 5px;\n        }\n\n        .sidebar.expanded1 .text,\n        .sidebar:hover .text {\n            opacity: 1;\n            visibility: visible;\n            transition-delay: 0.8s;\n        }\n\n        .main_content {\n            top: 105px;\n            position: relative;\n            color: black;\n            margin-top: 10px;\n            margin-left: 100px;\n            padding: 2px;\n            transition: margin-left 0.3s ease;\n        }\n\n        .sidebar.expanded1~.main_content {\n            margin-left: 400px;\n        }\n\n        .info-box {\n            text-align: center;\n        }\n\n        .info-label {\n            margin-bottom: 10px;\n            font-size: 18px;\n            font-weight: bold;\n        }\n\n        .info-rectangle {\n            width: 98%;\n            padding-right: -100px;\n            background-color: #fcfcfc;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            border-radius: 10px;\n        }\n\n        .table {\n            display: grid;\n            padding: 5px;\n            grid-template-columns: 6.5vw 1fr 1fr 1fr 1fr 1fr 1fr;\n            gap: 5px;\n        }\n\n        .row {\n            display: contents;\n        }\n\n        .cell {\n            background: white;\n            padding: 20px;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            min-height: 30px;\n            text-align: left;\n        }\n\n        .header-row .cell {\n            background: #EDF3FE;\n            font-weight: bold;\n            text-align: center;\n        }\n\n        .time {\n            font-weight: bold;\n            background: #EDF3FE;\n            padding: 20px;\n        }\n\n        .subject a {\n            color: blue;\n            text-decoration: none;\n        }\n\n        .subject {\n            cursor: pointer;\n            background-color: #fff;\n            font-size: 14px;\n            line-height: 1.4;\n            transition: background-color 0.3s;\n        }\n\n        .subject:hover {\n            background-color: #dee7f9c8\n        }\n\n        .green {\n            border-left: 5px solid green;\n        }\n\n        .blue {\n            border-left: 5px solid rgb(0, 68, 255);\n        }\n\n        .purple {\n            border-left: 5px solid purple;\n        }\n\n        .cyan {\n            border-left: 5px solid rgb(17, 4, 90);\n        }\n\n        .info-subject {\n            margin-bottom: 10px;\n            font-size: 30px;\n            font-weight: bold;\n        }\n\n        .task_info_table {\n            display: grid;\n            padding: 6px;\n            grid-template-columns: 1fr 3fr;\n            gap: 5px;\n        }\n\n        .task_state {\n            min-height: 150px;\n            min-width: 200px;\n            background: #EDF3FE;\n            padding: 20px;\n            transition: all 0.3s ease;\n        }\n\n        .task_table {\n            display: grid;\n            min-width: 360px;\n            background: #EDF3FE;\n            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;\n            gap: 5px;\n        }\n\n        @media (max-width: 2300px) {\n            .task_table {\n                grid-template-columns: 1fr 1fr 1fr 1fr;\n            }\n        }\n\n        @media (max-width: 1500px) {\n            .task_table {\n                grid-template-columns: 1fr 1fr 1fr;\n            }\n\n            .task_state {\n                min-width: 300px;\n            }\n        }\n\n        @media (max-width: 1000px) {\n            .task_table {\n                grid-template-columns: 1fr 1fr;\n            }\n        }\n\n        @media (max-width: 900px) {\n            .task_table {\n                grid-template-columns: 1fr;\n                min-width: 200px;\n            }\n        }\n\n        @media (max-width: 810px) {\n            .task_info_table {\n                grid-template-columns: 1fr;\n            }\n        }\n\n        .task {\n            background: white;\n            padding: 20px;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            min-height: 50px;\n            text-align: left;\n        }\n\n        .teacher-card {\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 20px;\n            max-width: 500px;\n            margin: 0 auto;\n        }\n\n        .teacher-title {\n            font-size: 18px;\n            font-weight: bold;\n            text-align: left;\n            margin: 0 0 15px 0;\n            padding-left: 10px;\n        }\n\n        .teacher-info {\n            display: flex;\n            align-items: center;\n            justify-content: flex-start;\n        }\n\n        .teacher-photo {\n            width: 100px;\n            height: 100px;\n            border-radius: 50%;\n            object-fit: cover;\n            margin-right: 20px;\n        }\n\n        .teacher-details {\n            flex: 1;\n            text-align: left;\n        }\n\n        .teacher-details p {\n            margin: 5px 0;\n        }\n\n        .msg-button {\n            margin-top: 10px;\n            background-color: #0017e2;\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 14px;\n        }\n\n        .msg-button:hover {\n            background-color: #3054b8;\n        }\n\n        .hidden {\n            display: none;\n        }\n\n        .lab-details {\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 20px;\n            max-width: 500px;\n            margin: 0 auto;\n        }\n\n        .lab-comment {\n            padding: 20px;\n        }\n\n        .task-status {\n            font-size: 14px;\n            color: #f00;\n            /* или другой цвет */\n            margin-top: 8px;\n        }\n\n        /* Новый блок с заданием */\n        .assignment-details {\n            margin-top: 20px;\n        }\n\n        .assignment-details .info-rectangle {\n            background: #EDF3FE;\n            border-radius: 10px;\n            padding: 20px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n        }\n\n        /* Прогресс-бар (если не добавлены ранее) */\n        .progress-container {\n            background-color: #f3f3f3;\n            border-radius: 8px;\n            height: 10px;\n            width: 100%;\n            overflow: hidden;\n            margin-top: 10px;\n        }\n\n        .progress-bar {\n            height: 100%;\n            background-color: #4caf50;\n            transition: width 1s ease;\n        }\n\n        .add-button {\n            position: absolute;\n            right: 5px;\n            bottom: 5px;\n            width: 24px;\n            height: 24px;\n            border: none;\n            border-radius: 50%;\n            background-color: #edf3fe;\n            color: #000;\n            font-weight: bold;\n            cursor: pointer;\n            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n            display: none;\n        }\n\n        .cell:hover .add-button {\n            display: block;\n        }\n\n        .modal {\n            display: none;\n            position: fixed;\n            top: 20%;\n            left: 50%;\n            transform: translateX(-50%);\n            background: white;\n            padding: 20px;\n            z-index: 100;\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n            border-radius: 10px;\n        }\n        .message {\n            padding: 8px 12px;\n            margin-bottom: 10px;\n            border-radius: 5px;\n            background-color: #f0f0f0;\n            word-wrap: break-word;\n        }\n\n        .message strong {\n            color: #0D47A1;\n        }\n\n        .message-time {\n            font-size: 0.8em;\n            color: #666;\n            margin-top: 3px;\n            text-align: right;\n        }\n\n        .chat-messages {\n            height: 400px;\n            overflow-y: auto;\n            padding: 10px;\n            border: 1px solid #ddd;\n            margin-bottom: 10px;\n            background-color: #fff;\n            border-radius: 5px;\n        }\n        /* Сообщения преподавателей */\n        .teacher-message {\n            background-color: #FFE0B2; /* Оранжевый фон */\n            border-left: 3px solid #FF9800; /* Оранжевая полоса слева */\n        }\n\n        .message {\n            padding: 8px 12px;\n            margin-bottom: 10px;\n            border-radius: 5px;\n            background-color: #f0f0f0;\n            word-wrap: break-word;\n            position: relative;\n        }\n\n        .message strong {\n            color: #0D47A1;\n        }\n\n        .message-time {\n            font-size: 0.8em;\n            color: #666;\n            margin-top: 3px;\n            text-align: right;\n        }\n`;\n\nmsg.cssText = css;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 180,
        "wires": [
            [
                "9647228e347af4de"
            ]
        ]
    },
    {
        "id": "d28322e8826f5460",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "name": "получение роли",
        "func": "// Проверяем, что получили роль пользователя\nif (!msg.payload || msg.payload.length === 0) {\n    node.error(\"Не удалось получить роль пользователя\", msg);\n    return [null, msg];\n}\n\nconst userRole = msg.payload[0].role;\nconst userName = msg.payload[0].username;\nmsg.userRole = userRole;\nmsg.userName = userName;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 180,
        "wires": [
            [
                "8accc27ec328375d"
            ]
        ]
    },
    {
        "id": "5cae1dc872a4769e",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "select * from events",
        "name": "SQLite DB",
        "x": 290,
        "y": 180,
        "wires": [
            [
                "d28322e8826f5460"
            ]
        ]
    },
    {
        "id": "0afab019420edc5a",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 180,
        "wires": []
    },
    {
        "id": "http-in-chat-messages",
        "type": "http in",
        "z": "8cd62b9679ad11ce",
        "name": "Получить сообщения чата",
        "url": "/get-chat-messages",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 400,
        "y": 800,
        "wires": [
            [
                "function-get-chat-messages"
            ]
        ]
    },
    {
        "id": "http-in-send-message",
        "type": "http in",
        "z": "8cd62b9679ad11ce",
        "name": "Отправить сообщение",
        "url": "/send-message",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 200,
        "y": 860,
        "wires": [
            [
                "815d85a6c228298b"
            ]
        ]
    },
    {
        "id": "function-get-chat-messages",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "name": "Получить сообщения чата",
        "func": "const chatname = msg.req.query.chatname;\nmsg.topic = `SELECT *, datetime(created_at, 'localtime') as created_at FROM messages WHERE chatname = '${chatname}' ORDER BY created_at ASC`;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 800,
        "wires": [
            [
                "sqlite-get-messages"
            ]
        ]
    },
    {
        "id": "function-send-message",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "name": "Отправить сообщение",
        "func": "\nconst chatname = msg.req.body.chatname;\nconst text = msg.req.body.text;\nconst username = msg.userName || 'Аноним';\nconst gruppa = msg.userRole || 'student';\n\nmsg.topic = `INSERT INTO messages (chatname, username, text, gruppa) VALUES ('${chatname}', '${username}', '${text}', '${gruppa}')`;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 860,
        "wires": [
            [
                "sqlite-insert-message",
                "http-response-send-message"
            ]
        ]
    },
    {
        "id": "sqlite-get-messages",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLite DB",
        "x": 1110,
        "y": 800,
        "wires": [
            [
                "http-response-chat-messages"
            ]
        ]
    },
    {
        "id": "sqlite-insert-message",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLite DB",
        "x": 930,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "http-response-chat-messages",
        "type": "http response",
        "z": "8cd62b9679ad11ce",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1430,
        "y": 800,
        "wires": []
    },
    {
        "id": "http-response-send-message",
        "type": "http response",
        "z": "8cd62b9679ad11ce",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 1440,
        "y": 860,
        "wires": []
    },
    {
        "id": "06f16478c1bbcc94",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 280,
        "wires": []
    },
    {
        "id": "d5aabec248b40f0c",
        "type": "debug",
        "z": "8cd62b9679ad11ce",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 400,
        "y": 280,
        "wires": []
    },
    {
        "id": "815d85a6c228298b",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "name": "Отправить сообщение",
        "func": "// Получаем ID пользователя из куки\nconst userId = msg.req.cookies.user_id;\nif (!userId) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\nmsg.topic = `SELECT role, username FROM users WHERE id = '${userId}'`;\nreturn [msg, null];",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 940,
        "wires": [
            [
                "0557e0b68672f31f"
            ]
        ]
    },
    {
        "id": "937fa9c88c95ae53",
        "type": "function",
        "z": "8cd62b9679ad11ce",
        "name": "получение роли",
        "func": "// Проверяем, что получили роль пользователя\nif (!msg.payload || msg.payload.length === 0) {\n    node.error(\"Не удалось получить роль пользователя\", msg);\n    return [null, msg];\n}\n\nconst userRole = msg.payload[0].role;\nconst userName = msg.payload[0].username;\nmsg.userRole = userRole;\nmsg.userName = userName;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 1040,
        "wires": [
            [
                "function-send-message"
            ]
        ]
    },
    {
        "id": "0557e0b68672f31f",
        "type": "sqlite",
        "z": "8cd62b9679ad11ce",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "select * from events",
        "name": "SQLite DB",
        "x": 230,
        "y": 1040,
        "wires": [
            [
                "937fa9c88c95ae53"
            ]
        ]
    },
    {
        "id": "f85c6b58bdda92bd",
        "type": "http in",
        "z": "5ca377efdfba60c4",
        "name": "",
        "url": "/mainprf",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 60,
        "wires": [
            [
                "6a4a0eced5de0592"
            ]
        ]
    },
    {
        "id": "fbdcf4253bcdf6b1",
        "type": "template",
        "z": "5ca377efdfba60c4",
        "name": "Внешний вид профиля",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"ru\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Система выполнения заданий</title>\n    <style>\n        {{{cssText}}}\n    </style>\n    <link rel=\"icon\" type=\"image/png\" href=\"https://cabinet.ssau.ru/asset/favicon.ico\">\n</head>\n\n<body>\n\n    <header class=\"topbar\">\n        <div class=\"divlogoname\"><img src=\"https://sun9-71.userapi.com/impg/5bKKjXmZHXD-py_TrIJPKFRQ7bS0QHjZuGtpmw/76Nc37KiTHI.jpg?size=1890x185&quality=95&sign=f3cefb5512a49c2d843e894fda497b97&type=album\" class=\"logoname\">\n        </div>\n    </header>\n\n    <div class=\"sidebar\" id=\"sidebar\">\n        <div class=\"logocenter\" id=\"logocenter\">\n            <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png\" class=\"logo\" id=\"logo\">\n        </div>\n        <button class=\"toggle-btn\" id=\"toggleBtn\">\n        <img src=\"https://github.com/Kulakov1Dima/SsauWorkspace/blob/main/hahaton_exemple_fronted/expand.png?raw=true\">\n    </button>\n        <ul class=\"menu\" id=\"menu\">\n            <li>\n                <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/home1.png\" class=\"icon\">\n                <span class=\"text\">Главная</span>\n            </li>\n            <li onclick=\"location.href='http://localhost:1880/messenger';\" style=\"cursor:pointer;\">\n                <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/messenger.png\" class=\"icon\">\n                <span class=\"text\">Мессенджер</span>\n            </li>\n            <li onclick=\"location.href='http://localhost:1880/ssau';\" style=\"cursor:pointer;\">\n                <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/schedule.png\" class=\"icon\">\n                <span class=\"text\">Расписание</span>\n            </li>\n            <li onclick=\"location.href='http://localhost:1880/logout';\" style=\"cursor:pointer;\">\n                <span class=\"logout\">Выйти</span>\n            </li>\n        </ul>\n    </div>\n\n    <div class=\"main_content\">\n        <div class=\"profile-container\">\n            <h1>Профиль</h1>\n            <h2>Редактирование</h2>\n            \n            <div class=\"profile-form\">\n                <div class=\"form-group\">\n                    <label for=\"username\">Имя пользователя:</label>\n                    <input type=\"text\" id=\"username\" value=\"{{userName}}\">\n                </div>\n                \n                <div class=\"form-group\">\n                    <label for=\"password\">Пароль:</label>\n                    <input type=\"password\" id=\"password\" placeholder=\"••••••••\">\n                </div>\n                \n                <div class=\"form-group\">\n                    <label for=\"gruppa\">Группа:</label>\n                    <input type=\"text\" id=\"gruppa\" value=\"{{gruppa}}\">\n                </div>\n                \n                <button id=\"saveBtn\" class=\"save-button\">Применить изменения</button>\n                <div id=\"errorMessage\" class=\"error-message\"></div>\n                <div id=\"successMessage\" class=\"success-message\"></div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Сохраняем исходные данные для сравнения\n        let originalData = {\n            username: '{{userName}}',\n            password: '{{password}}',\n            gruppa: '{{gruppa}}'\n        };\n        \n        // Функция для сброса сообщений через 3 секунды\n        function resetMessages() {\n            setTimeout(() => {\n                document.getElementById('errorMessage').textContent = '';\n                document.getElementById('successMessage').textContent = '';\n            }, 3000);\n        }\n\n        document.addEventListener('DOMContentLoaded', function() {\n            // Обработка сворачивания/разворачивания боковой панели\n            const sidebar = document.getElementById('sidebar');\n            const toggleBtn = document.getElementById('toggleBtn');\n            const logo = document.getElementById('logo');\n            const logocenter = document.getElementById('logocenter');\n            const menu = document.getElementById('menu');\n            \n            toggleBtn.addEventListener('click', () => {\n                if (!toggleBtn.classList.contains('expanded1')) {\n                    toggleBtn.classList.add('expanded1');\n                    sidebar.classList.add('expanded1');\n                }\n                else{\n                    toggleBtn.classList.remove('expanded1');\n                    sidebar.classList.remove('expanded1');\n                }\n            });\n\n            sidebar.addEventListener('mouseenter', () => {\n                logo.src = 'http://localhost:1880/logo_osnovnoy.png';\n                logo.classList.add('small');\n                logocenter.classList.add('small');\n                menu.classList.add('small');\n            });\n\n            sidebar.addEventListener('mouseleave', () => {\n                if (!sidebar.classList.contains('expanded1')) {\n                    logo.src = 'https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png';\n                    logo.classList.remove('small');\n                    logocenter.classList.remove('small');\n                    menu.classList.remove('small');\n                }\n            });\n\n            // Обработка сохранения профиля\n            const saveBtn = document.getElementById('saveBtn');\n            const errorMessage = document.getElementById('errorMessage');\n            const successMessage = document.getElementById('successMessage');\n            \n            saveBtn.addEventListener('click', function() {\n                const username = document.getElementById('username').value.trim();\n                const password = document.getElementById('password').value.trim();\n                const gruppa = document.getElementById('gruppa').value.trim();\n                \n                // Очищаем предыдущие сообщения\n                errorMessage.textContent = '';\n                successMessage.textContent = '';\n                \n                // Проверка на пустые поля\n                if (!username || !gruppa) {\n                    errorMessage.textContent = 'Имя пользователя и группа должны быть заполнены!';\n                    resetMessages();\n                    return;\n                }\n\n                if (password && password.trim() !== '' && password.length < 6) {\n                    errorMessage.textContent = 'Пароль должен содержать минимум 6 символов!';\n                    resetMessages();\n                    return;\n                }\n                \n                // Проверка на изменения\n                if (username === originalData.username && \n                    password === originalData.password && \n                    gruppa === originalData.gruppa) {\n                    errorMessage.textContent = 'Нет изменений для сохранения!';\n                    resetMessages();\n                    return;\n                }\n                \n                // Отправка данных на сервер\n                fetch('/update_profile', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify({\n                        username: username,\n                        password: password,\n                        gruppa: gruppa\n                    })\n                })\n                .then(response => {\n                    if (!response.ok) {\n                        throw new Error('Ошибка сети');\n                    }\n                    return response.json();\n                })\n                .then(data => {\n                    if (data.success) {\n                        successMessage.textContent = 'Изменения успешно сохранены!';\n                        // Обновляем оригинальные данные\n                        originalData = {\n                            username: username,\n                            password: password,\n                            gruppa: gruppa\n                        };\n                    } else {\n                        errorMessage.textContent = 'Ошибка при сохранении: ' + (data.message || 'Неизвестная ошибка');\n                        // Восстанавливаем значения из оригинальных данных\n                        document.getElementById('username').value = originalData.username;\n                        document.getElementById('password').value = originalData.password;\n                        document.getElementById('gruppa').value = originalData.gruppa;\n                    }\n                    resetMessages();\n                })\n                .catch(error => {\n                    errorMessage.textContent = 'Ошибка сети: ' + error.message;\n                    // Восстанавливаем значения из оригинальных данных\n                    document.getElementById('username').value = originalData.username;\n                    document.getElementById('password').value = originalData.password;\n                    document.getElementById('gruppa').value = originalData.gruppa;\n                    resetMessages();\n                });\n            });\n        });\n    </script>\n\n</body>\n\n</html>",
        "output": "str",
        "x": 810,
        "y": 60,
        "wires": [
            [
                "a53ae1e7ca8f1246"
            ]
        ],
        "icon": "node-red/parser-html.svg"
    },
    {
        "id": "a53ae1e7ca8f1246",
        "type": "http response",
        "z": "5ca377efdfba60c4",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 60,
        "wires": []
    },
    {
        "id": "c059d09ca6b29df7",
        "type": "function",
        "z": "5ca377efdfba60c4",
        "name": "css",
        "func": "var css = `\nbody {\n    font-family: Arial, sans-serif;\n    margin: 0;\n    padding: 0;\n    height: 1200px;\n    background-color: #edf3fec1;\n}\n\n.topbar {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    background-color: #fff;\n    color: white;\n    display: flex;\n    align-items: center;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding-left: 20px;\n    z-index: 1;\n}\n\n.sidebar {\n    width: 45px;\n    height: 100%;\n    background-color: #fff;\n    color: white;\n    position: fixed;\n    top: 0;\n    left: 0;\n    transition: width 0.3s;\n    overflow: visible;\n    white-space: nowrap;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding: 10px;\n    z-index: 10;\n}\n\n.main_content {\n    top: 105px;\n    position: relative;\n    color: black;\n    margin-top: 10px;\n    margin-left: 100px;\n    padding: 2px;\n    transition: margin-left 0.3s ease;\n}\n\n.profile-container {\n    max-width: 800px;\n    margin: 20px auto;\n    background: white;\n    padding: 30px;\n    border-radius: 10px;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n}\n\n.profile-container h1 {\n    font-size: 28px;\n    margin-bottom: 5px;\n    color: #333;\n}\n\n.profile-container h2 {\n    font-size: 18px;\n    margin-top: 0;\n    margin-bottom: 30px;\n    color: #666;\n    font-weight: normal;\n}\n\n.profile-form {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.form-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.form-group label {\n    font-weight: bold;\n    color: #444;\n}\n\n.form-group input {\n    padding: 10px 15px;\n    border: 1px solid #ddd;\n    border-radius: 5px;\n    font-size: 16px;\n    transition: border-color 0.3s;\n}\n\n.form-group input:focus {\n    border-color: #0017e2;\n    outline: none;\n}\n\n.save-button {\n    padding: 12px 20px;\n    background-color: #0017e2;\n    color: white;\n    border: none;\n    border-radius: 5px;\n    font-size: 16px;\n    cursor: pointer;\n    transition: background-color 0.3s;\n    margin-top: 20px;\n}\n\n.save-button:hover {\n    background-color: #3054b8;\n}\n\n.error-message {\n    color: #d32f2f;\n    margin-top: 15px;\n    font-size: 14px;\n    min-height: 20px;\n}\n\n.success-message {\n    color: #388e3c;\n    margin-top: 15px;\n    font-size: 14px;\n    min-height: 20px;\n}\n\n/* Остальные стили из предыдущей версии */\n.sidebar.expanded1 {\n    width: 340px;\n    transition: width 0.7s ease;\n}\n\n.sidebar:hover {\n    width: 340px;\n    transition: width 0.7s ease;\n}\n\n.toggle-btn {\n    cursor: pointer;\n    text-align: center;\n    padding: 10px;\n    background-color: #EDF3FE;\n    border: none;\n    color: white;\n    width: 33px;\n    height: 33px;\n    border-radius: 50%;\n    outline: none;\n    position: absolute;\n    left: 82%;\n    top: 40px;\n    box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n    padding: 10px;\n}\n\n.toggle-btn.expanded1 {\n    transform: rotate(180deg);\n}\n\n.toggle-btn img {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    display: block;\n    transition: transform 0.2s ease;\n}\n\n.button-list {\n    list-style-type: none;\n    padding: 0;\n    margin: 0;\n}\n\n.button-list li {\n    display: flex;\n    align-items: center;\n    padding: 10px;\n}\n\n.button-list li img {\n    width: 24px;\n    height: 24px;\n    margin-right: 10px;\n}\n\n.button-list li:hover {\n    background-color: #555;\n}\n\n.text {\n    display: none;\n}\n\n.sidebar.expanded .text {\n    display: inline;\n}\n\n.sidebar:hover .text {\n    display: inline;\n}\n\n.logo {\n    width: 30px;\n    height: auto;\n    left: 84%;\n}\n\n.logo.small {\n    width: 300px;\n    height: auto;\n    transition: width 0.5s ease;\n}\n\n.logocenter {\n    border: 5px solid;\n    position: absolute;\n    top: 45px;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    padding: 10px;\n}\n\n.logocenter.small {\n    border: 6px solid;\n    position: absolute;\n    top: 110px;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    padding: 10px;\n}\n\n.logoname {\n    width: 230px;\n    height: auto;\n}\n\n.divlogoname {\n    height: auto;\n    position: absolute;\n    top: 20px;\n    left: 80px;\n    padding: 10px;\n}\n\n.menu {\n    list-style: none;\n    position: absolute;\n    color: black;\n    top: 60px;\n    width: 95%;\n    padding: 0;\n    margin: 40px 0 0 0;\n    transition: transform 0.7s ease;\n}\n\n.menu.small {\n    list-style: none;\n    position: absolute;\n    color: black;\n    top: 170px;\n    width: 95%;\n    padding: 0;\n    margin: 40px 0 0 0;\n}\n\n.menu li {\n    display: flex;\n    align-items: center;\n    padding: 12px;\n    cursor: pointer;\n    transition: background 0.6s;\n}\n\n.menu li:hover {\n    background: #EDF3FE;\n}\n\n.icon {\n    width: 24px;\n    height: 24px;\n    margin-right: 40px;\n}\n\n.text {\n    display: inline-block;\n    opacity: 0;\n    transition: opacity 0.3s ease 0.8s;\n    font-size: 18px;\n}\n\n.sidebar:not(.expanded1) .menu li,\n.sidebar:hover:not(.expanded1) .menu li {\n    justify-content: left;\n}\n\n.sidebar:not(.expanded1) .text {\n    opacity: 0;\n    visibility: hidden;\n}\n\n.sidebar.expanded1 .menu li,\n.sidebar:hover .menu li {\n    justify-content: flex-start;\n    padding-left: 5px;\n}\n\n.sidebar.expanded1 .text,\n.sidebar:hover .text {\n    opacity: 1;\n    visibility: visible;\n    transition-delay: 0.8s;\n}\n\n.sidebar.expanded1~.main_content {\n    margin-left: 400px;\n}\n`;\n\nmsg.cssText = css;\nmsg.userRole = msg.userRole;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 140,
        "wires": [
            [
                "fbdcf4253bcdf6b1"
            ]
        ]
    },
    {
        "id": "6a4a0eced5de0592",
        "type": "function",
        "z": "5ca377efdfba60c4",
        "name": "Проверка авторизации",
        "func": "// Проверяем куки\nif (!msg.req.cookies || !msg.req.cookies.auth_token) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\n// Получаем ID пользователя из куки\nconst userId = msg.req.cookies.user_id;\nif (!userId) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\nmsg.topic = `SELECT * FROM users WHERE id = '${userId}'`;\nmsg.userId = userId;\n\nreturn [msg, null];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 60,
        "wires": [
            [
                "86671ee44ac96686"
            ],
            [
                "a53ae1e7ca8f1246"
            ]
        ]
    },
    {
        "id": "3b10f71002900112",
        "type": "function",
        "z": "5ca377efdfba60c4",
        "name": "получение данных пользователя",
        "func": "// Проверяем, что получили роль пользователя\nif (!msg.payload || msg.payload.length === 0) {\n    node.error(\"Не удалось получить данные пользователя\", msg);\n    return [null, msg];\n}\n\nconst userRole = msg.payload[0].role;\nmsg.userRole = userRole;\nconst userName = msg.payload[0].username;\nmsg.userName = userName;\nconst password = msg.payload[0].password;\nmsg.password = \"\";\nconst gruppa = msg.payload[0].gruppa;\nmsg.gruppa = gruppa;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 140,
        "wires": [
            [
                "c059d09ca6b29df7"
            ]
        ]
    },
    {
        "id": "86671ee44ac96686",
        "type": "sqlite",
        "z": "5ca377efdfba60c4",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "select * from events",
        "name": "SQLite DB",
        "x": 250,
        "y": 140,
        "wires": [
            [
                "3b10f71002900112"
            ]
        ]
    },
    {
        "id": "f00338d477e91dab",
        "type": "http in",
        "z": "5ca377efdfba60c4",
        "name": "",
        "url": "/update_profile",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 220,
        "wires": [
            [
                "949baab3f79baf9a"
            ]
        ]
    },
    {
        "id": "949baab3f79baf9a",
        "type": "function",
        "z": "5ca377efdfba60c4",
        "name": "Проверка авторизации для обновления",
        "func": "// Проверяем куки\nif (!msg.req.cookies || !msg.req.cookies.auth_token) {\n    msg.payload = { success: false, message: \"Не авторизован\" };\n    return [null, msg];\n}\n\n// Получаем ID пользователя из куки\nconst userId = msg.req.cookies.user_id;\nif (!userId) {\n    msg.payload = { success: false, message: \"Не авторизован\" };\n    return [null, msg];\n}\n\n// Получаем данные из тела запроса\nconst body = msg.req.body;\nif (!body.username || !body.password || !body.gruppa) {\n    msg.payload = { success: false, message: \"Все поля обязательны для заполнения\" };\n    return [null, msg];\n}\n\nmsg.userId = userId;\nmsg.username = body.username;\nmsg.password = body.password;\nmsg.gruppa = body.gruppa;\n\nreturn [msg, null];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 220,
        "wires": [
            [
                "c0472d41a1ab9d76"
            ],
            [
                "738728daf3386505"
            ]
        ]
    },
    {
        "id": "c0472d41a1ab9d76",
        "type": "function",
        "z": "5ca377efdfba60c4",
        "name": "Проверка изменений",
        "func": "// Получаем текущие данные пользователя\nmsg.topic = `SELECT username, password, gruppa FROM users WHERE id = '${msg.userId}'`;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 280,
        "wires": [
            [
                "4f18480bc06d28cd"
            ]
        ]
    },
    {
        "id": "4f18480bc06d28cd",
        "type": "sqlite",
        "z": "5ca377efdfba60c4",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLite DB",
        "x": 1110,
        "y": 280,
        "wires": [
            [
                "1b40683c09233eb2"
            ]
        ]
    },
    {
        "id": "1b40683c09233eb2",
        "type": "function",
        "z": "5ca377efdfba60c4",
        "name": "Обновление данных",
        "func": "const bcrypt = bcryptjs;\n// Весь код заменить на:\nif (!msg.payload || msg.payload.length === 0) {\n    msg.payload = { success: false, message: \"Пользователь не найден\" };\n    return msg;\n}\n\nconst currentData = msg.payload[0];\nconst saltRounds = 10;\nlet updates = [];\nlet params = {};\n\n// Проверка изменений\nif (currentData.username !== msg.username) {\n    updates.push(\"username = :username\");\n    params.username = msg.username;\n}\n\nif (msg.password && msg.password.trim() !== '') {\n    const hash = bcrypt.hashSync(msg.password, saltRounds);\n    updates.push(\"password = :password\");\n    params.password = hash;\n}\n\nif (currentData.gruppa !== msg.gruppa) {\n    updates.push(\"gruppa = :gruppa\");\n    params.gruppa = msg.gruppa;\n}\n\nif (updates.length === 0) {\n    msg.payload = { success: false, message: \"Нет изменений для сохранения\" };\n    return msg;\n}\n\nmsg.topic = `UPDATE users SET \n    username = '${msg.username.replace(/'/g, \"''\")}', \n    password = '${params.password.replace(/'/g, \"''\")}', \n    gruppa = '${msg.gruppa.replace(/'/g, \"''\")}'\nWHERE id = '${msg.userId}'`;\nmsg.params = params;\nreturn msg;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "bcryptjs",
                "module": "bcryptjs"
            }
        ],
        "x": 900,
        "y": 340,
        "wires": [
            [
                "f7fd8e03e0b91b84"
            ]
        ]
    },
    {
        "id": "f7fd8e03e0b91b84",
        "type": "sqlite",
        "z": "5ca377efdfba60c4",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "SQLite DB",
        "x": 1110,
        "y": 340,
        "wires": [
            [
                "2bbb7943487c221d"
            ]
        ]
    },
    {
        "id": "2bbb7943487c221d",
        "type": "function",
        "z": "5ca377efdfba60c4",
        "name": "Формирование ответа",
        "func": "msg.payload = { success: true, message: \"Данные успешно обновлены\" };\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1330,
        "y": 340,
        "wires": [
            [
                "738728daf3386505"
            ]
        ]
    },
    {
        "id": "738728daf3386505",
        "type": "http response",
        "z": "5ca377efdfba60c4",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1510,
        "y": 220,
        "wires": []
    },
    {
        "id": "8fdd5b53ce49cde7",
        "type": "debug",
        "z": "5ca377efdfba60c4",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1570,
        "y": 300,
        "wires": []
    },
    {
        "id": "775516f75b5da7cc",
        "type": "http in",
        "z": "b8ad15e59845239e",
        "name": "",
        "url": "/ssau",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 80,
        "wires": [
            [
                "6ed544fd13ce011c"
            ]
        ]
    },
    {
        "id": "8269f2a4a554d9e6",
        "type": "template",
        "z": "b8ad15e59845239e",
        "name": "Внешний вид расписания",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"ru\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Система выполнения заданий</title>\n    <style>\n        {{{cssText}}}\n    </style>\n    <link rel=\"icon\" type=\"image/png\" href=\"https://cabinet.ssau.ru/asset/favicon.ico\">\n</head>\n\n<div class=\"modal\" id=\"eventModal\">\n    <h3>Добавить событие</h3>\n    <input type=\"text\" id=\"eventGruppa\" placeholder=\"Группа\">\n    <input type=\"text\" id=\"eventName\" placeholder=\"Предмет\">\n    <input type=\"text\" id=\"eventTeacher\" placeholder=\"Преподаватель\">\n    <input type=\"text\" id=\"eventRoom\" placeholder=\"Аудитория\">\n    <input type=\"text\" id=\"eventConference\" placeholder=\"Конференция\">\n    <input type=\"text\" id=\"eventPlatform\" placeholder=\"Платформа\">\n    <select id=\"eventType\">\n        <option value=\"Лекция\">Лекция</option>\n        <option value=\"Лабораторная\">Лабораторная</option>\n        <option value=\"Практика\">Практика</option>\n        <option value=\"Экзамен\">Экзамен</option>\n    </select>\n    <button onclick=\"saveEvent()\">ОК</button>\n    <button onclick=\"closeModal()\">Отмена</button>\n</div>\n\n<body>\n\n    <header class=\"topbar\">\n        <div class=\"divlogoname\"><img src=\"https://sun9-71.userapi.com/impg/5bKKjXmZHXD-py_TrIJPKFRQ7bS0QHjZuGtpmw/76Nc37KiTHI.jpg?size=1890x185&quality=95&sign=f3cefb5512a49c2d843e894fda497b97&type=album\" class=\"logoname\">\n        </div>\n    </header>\n\n    <div class=\"sidebar\" id=\"sidebar\">\n        <div class=\"logocenter\" id=\"logocenter\">\n            <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png\" class=\"logo\" id=\"logo\">\n        </div>\n        <button class=\"toggle-btn\" id=\"toggleBtn\">\n        <img src=\"https://github.com/Kulakov1Dima/SsauWorkspace/blob/main/hahaton_exemple_fronted/expand.png?raw=true\">\n    </button>\n        <ul class=\"menu\" id=\"menu\">\n            <li onclick=\"location.href='http://localhost:1880/mainprf';\" style=\"cursor:pointer;\">\n                <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/home1.png\" class=\"icon\">\n                <span class=\"text\">Главная</span>\n            </li>\n            <li onclick=\"location.href='http://localhost:1880/messenger';\" style=\"cursor:pointer;\">\n                <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/messenger.png\" class=\"icon\">\n                <span class=\"text\">Мессенджер</span>\n            </li>\n            <li onclick=\"location.href='http://localhost:1880/ssau';\" style=\"cursor:pointer;\">\n                <img src=\"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/schedule.png\" class=\"icon\">\n                <span class=\"text\">Расписание</span>\n            </li>\n            <li onclick=\"location.href='http://localhost:1880/logout';\" style=\"cursor:pointer;\">\n                <img src=\"https://sun9-72.userapi.com/impg/ISQCIKy3YIJnHpR2C05AvvdH7xc2frA4BH5HQw/DDx8APwc3Pg.jpg?size=67x66&quality=95&sign=93312bbe4606d61e6667decf46a421fa&type=album\" class=\"icon\">\n                <span class=\"text\">Выйти</span>\n            </li>\n        </ul>\n    </div>\n\n    <div class=\"main_content\">\n        <div>\n            <div class=\"info-label\"></div>\n            <div class=\"info-rectangle\">\n                <div class=\"table\" id=\"scheduleTable\">\n                    <div class=\"row header-row\" id=\"tableHeader\">\n                        <div class=\"cell time\">Время</div>\n                    </div>\n                </div>\n            </div>\n    \n            <!-- Измененный блок - теперь виден всегда (для студентов) -->\n            <div id=\"teacherScheduleContainer\" style=\"margin-top: 30px;\">\n                <!-- Добавляем условие отображения только для студентов -->\n                <div style=\"display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;\"\n                    id=\"teacherSelectorBlock\">\n                    <div style=\"display: flex; align-items: center;\">\n                        <span style=\"margin-right: 10px; font-weight: bold;\">Просмотр расписания преподавателя:</span>\n                        <select id=\"teacherSelector\" style=\"padding: 8px; border-radius: 5px; border: 1px solid #ddd;\">\n                            <option value=\"\">Выберите преподавателя</option>\n                        </select>\n                    </div>\n                    <div id=\"teacherWeekNavigation\" style=\"display: none;\">\n                        <button onclick=\"changeTeacherWeek(-1)\">←</button>\n                        <span id=\"teacherWeekLabel\" style=\"margin: 0 10px;\"></span>\n                        <button onclick=\"changeTeacherWeek(1)\">→</button>\n                    </div>\n                </div>\n                <div id=\"teacherScheduleTable\" class=\"info-rectangle\"></div>\n            </div>\n    </div>\n\n    <script>\n        const userRole = '{{userRole}}' || 'student';\n        const isTeacher = userRole === 'teacher';\n\n        const imagesToPreload = [\n            \"http://localhost:1880/logo_osnovnoy.png\",\n            \"https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png\"\n        ];\n        \n        imagesToPreload.forEach(src => {\n            const img = new Image();\n            img.src = src;\n        });\n        \n        const sidebar = document.getElementById('sidebar');\n        const toggleBtn = document.getElementById('toggleBtn');\n        const logo = document.getElementById('logo');\n        const logocenter = document.getElementById('logocenter');\n        const menu = document.getElementById('menu');\n        \n        toggleBtn.addEventListener('click', () => {\n            if (!toggleBtn.classList.contains('expanded1')) {\n                toggleBtn.classList.add('expanded1');\n                sidebar.classList.add('expanded1');\n            }\n            else{\n                toggleBtn.classList.remove('expanded1');\n                sidebar.classList.remove('expanded1');\n            }\n        });\n\n        sidebar.addEventListener('mouseenter', () => {\n            logo.src = 'http://localhost:1880/logo_osnovnoy.png';\n            logo.classList.add('small');\n            logocenter.classList.add('small');\n            menu.classList.add('small');\n        });\n\n        sidebar.addEventListener('mouseleave', () => {\n            if (!sidebar.classList.contains('expanded1')) {\n                logo.src = 'https://raw.githubusercontent.com/Kulakov1Dima/SsauWorkspace/refs/heads/main/hahaton_exemple_fronted/logo_osnovnoy_small.png';\n                logo.classList.remove('small');\n                logocenter.classList.remove('small');\n                menu.classList.remove('small');\n            }\n        });\n\n        let currentMonday = getMonday(new Date());\n\n        let currentTeacherWeek = getMonday(new Date());\n        \n        function changeTeacherWeek(offset) {\n            currentTeacherWeek.setDate(currentTeacherWeek.getDate() + offset * 7);\n            const selectedTeacher = document.getElementById('teacherSelector').value;\n            if (selectedTeacher) {\n                updateTeacherWeekLabel();\n                loadTeacherSchedule(selectedTeacher);\n            }\n        }\n        \n        function updateTeacherWeekLabel() {\n            const yearLabel = document.getElementById('teacherWeekLabel');\n            const year = currentTeacherWeek.getFullYear();\n            const nextYear = currentTeacherWeek.getMonth() >= 8 ? year + 1 : year;\n            yearLabel.textContent = `${nextYear - 1} / ${nextYear} учебный год`;\n        }\n\n        function getMonday(date) {\n            const d = new Date(date);\n            const day = d.getDay();\n            const diff = d.getDate() - ((day + 6) % 7);\n            d.setDate(diff);\n            d.setHours(0, 0, 0, 0);\n            return d;\n        }\n\n        function formatDate(date) {\n            const year = date.getFullYear();\n            const month = String(date.getMonth() + 1).padStart(2, '0');\n            const day = String(date.getDate()).padStart(2, '0');\n            return `${year}-${month}-${day}`;\n        }\n\n        function formatDisplayDate(date) {\n            return date.toLocaleDateString('ru-RU', {\n                day: '2-digit',\n                month: '2-digit',\n                year: '2-digit'\n            });\n        }\n\n        function updateYearLabel() {\n            const yearLabel = document.querySelector('.info-label');\n            const year = currentMonday.getFullYear();\n            const nextYear = currentMonday.getMonth() >= 8 ? year + 1 : year;\n        \n            yearLabel.innerHTML = `\n            <button onclick=\"changeWeek(-1)\">←</button>\n            ${nextYear - 1} / ${nextYear} учебный год\n            <button onclick=\"changeWeek(1)\">→</button>\n            `;\n        }\n\n        function changeWeek(offset) {\n            currentMonday.setDate(currentMonday.getDate() + offset * 7);\n            renderSchedule();\n        }\n\n        function closeModal() {\n            document.getElementById('eventModal').style.display = 'none';\n        }\n\n        function loadTeachersList() {\n            if (isTeacher) return;\n            \n            const selector = document.getElementById('teacherSelector');\n            selector.innerHTML = '<option value=\"\">Загрузка...</option>';\n            selector.disabled = true;\n\n        \n        fetch('http://localhost:1880/tea')\n        .then(response => {\n        if (!response.ok) throw new Error(`HTTP error ${response.status}`);\n        return response.json();\n        })\n        .then(data => {\n        console.log('Server response:', data); // Для отладки\n        \n        if (!Array.isArray(data)) {\n        throw new Error('Ожидался массив преподавателей');\n        }\n        \n        selector.innerHTML = '<option value=\"\">Выберите преподавателя</option>';\n        \n        if (data.length === 0) {\n        const option = document.createElement('option');\n        option.value = '';\n        option.textContent = 'Нет преподавателей в базе';\n        selector.appendChild(option);\n        return;\n        }\n        \n        // Сортировка по алфавиту\n        data.sort((a, b) => a.localeCompare(b));\n        \n        data.forEach(teacher => {\n        const option = document.createElement('option');\n        option.value = teacher;\n        option.textContent = teacher;\n        selector.appendChild(option);\n        });\n        })\n        .catch(error => {\n        console.error('Teacher list load failed:', error);\n        selector.innerHTML = '<option value=\"\">Ошибка загрузки</option>';\n        })\n        .finally(() => {\n        selector.disabled = false;\n        });\n        }\n\n        function loadTeacherSchedule(teacherName) {\n        const teacherScheduleContainer = document.getElementById('teacherScheduleContainer');\n        const teacherScheduleTable = document.getElementById('teacherScheduleTable');\n        const teacherWeekNavigation = document.getElementById('teacherWeekNavigation');\n        \n        if (!teacherName) {\n        teacherScheduleTable.style.display = 'none';\n        teacherWeekNavigation.style.display = 'none';\n        return;\n        }\n        \n        teacherScheduleTable.style.display = 'block';\n        teacherWeekNavigation.style.display = 'flex';\n        teacherScheduleTable.innerHTML = 'Загрузка...';\n        \n        updateTeacherWeekLabel();\n        \n        const startDate = formatDate(currentTeacherWeek);\n        const endDate = formatDate(new Date(currentTeacherWeek.getTime() + 6 * 24 * 60 * 60 * 1000));\n        \n        fetch(`http://localhost:1880/tea_schedule?teacher=${encodeURIComponent(teacherName)}&start=${startDate}&end=${endDate}`)\n        .then(response => response.json())\n        .then(data => {\n        renderTeacherSchedule(data, teacherName);\n        })\n        .catch(error => {\n        console.error(\"Ошибка получения данных расписания преподавателя:\", error);\n        teacherScheduleTable.innerHTML = 'Ошибка загрузки расписания';\n        });\n        }\n\n        // Функция для отрисовки расписания преподавателя\n        function renderTeacherSchedule(data, teacherName) {\n        const allTimes = [\n        \"08:00 - 09:35\",\n        \"09:45 - 11:20\",\n        \"11:30 - 13:05\",\n        \"13:30 - 15:05\",\n        \"15:15 - 16:50\"\n        ];\n        \n        const teacherScheduleTable = document.getElementById('teacherScheduleTable');\n        teacherScheduleTable.innerHTML = '';\n        \n        const table = document.createElement('div');\n        table.className = 'table';\n        \n        // Заголовок таблицы\n        const headerRow = document.createElement('div');\n        headerRow.className = 'row header-row';\n        headerRow.innerHTML = '<div class=\"cell time\">Время</div>';\n        \n        // Дни недели (6 штук)\n        const dayNames = [\"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\"];\n        for (let i = 0; i < 6; i++) { const date=new Date(currentTeacherWeek.getTime()); date.setDate(date.getDate() + i); const\n            headerCell=document.createElement('div'); headerCell.className='cell' ; headerCell.innerHTML=`${dayNames[i]}<br>\n            ${formatDisplayDate(date)}`;\n            headerRow.appendChild(headerCell);\n            }\n        \n            table.appendChild(headerRow);\n        \n            // Для каждого временного слота — строка\n            allTimes.forEach(time => {\n            const row = document.createElement('div');\n            row.className = 'row';\n        \n            const timeCell = document.createElement('div');\n            timeCell.className = 'cell time';\n            timeCell.textContent = time;\n            row.appendChild(timeCell);\n        \n            // Для каждого дня недели — одна ячейка\n            for (let i = 0; i < 6; i++) { const dateObj=new Date(currentTeacherWeek.getTime());\n                dateObj.setDate(dateObj.getDate() + i); const dateStr=formatDate(dateObj); const\n                cell=document.createElement('div'); cell.className='cell' ; const event=data.find(ev=>\n                ev.date === dateStr &&\n                ev.time === time\n                );\n        \n                if (event) {\n                cell.classList.add('subject');\n                if (event.type === \"Лабораторная\") cell.classList.add('purple');\n                else if (event.type === \"Лекция\") cell.classList.add('green');\n                else if (event.type === \"Практика\") cell.classList.add('blue');\n                else if (event.type === \"Экзамен\") cell.classList.add('cyan');\n        \n                cell.innerHTML = `\n                <b>${event.name}</b><br>\n                <span>${event.gruppa}</span><br>\n                <span>${event.platform || event.room || ''}</span>\n                ${event.conference ? `<br><a href=\"${event.conference}\">Перейти в конференцию</a>` : ''}\n                `;\n                }\n        \n                row.appendChild(cell);\n                }\n        \n                table.appendChild(row);\n                });\n        \n                teacherScheduleTable.appendChild(table);\n                }function renderTeacherSchedule(data, teacherName) {\n                const allTimes = [\n                \"08:00 - 09:35\",\n                \"09:45 - 11:20\",\n                \"11:30 - 13:05\",\n                \"13:30 - 15:05\",\n                \"15:15 - 16:50\"\n                ];\n                \n                const teacherScheduleTable = document.getElementById('teacherScheduleTable');\n                teacherScheduleTable.innerHTML = '';\n                \n                const table = document.createElement('div');\n                table.className = 'table';\n                \n                // Заголовок таблицы\n                const headerRow = document.createElement('div');\n                headerRow.className = 'row header-row';\n                headerRow.innerHTML = '<div class=\"cell time\">Время</div>';\n                \n                // Дни недели (6 штук)\n                const dayNames = [\"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\"];\n                for (let i = 0; i < 6; i++) { const date=new Date(currentTeacherWeek.getTime()); date.setDate(date.getDate() + i); const\n                    headerCell=document.createElement('div'); headerCell.className='cell' ; headerCell.innerHTML=`${dayNames[i]}<br>\n                    ${formatDisplayDate(date)}`;\n                    headerRow.appendChild(headerCell);\n                    }\n                \n                    table.appendChild(headerRow);\n                \n                    // Для каждого временного слота — строка\n                    allTimes.forEach(time => {\n                    const row = document.createElement('div');\n                    row.className = 'row';\n                \n                    const timeCell = document.createElement('div');\n                    timeCell.className = 'cell time';\n                    timeCell.textContent = time;\n                    row.appendChild(timeCell);\n                \n                    // Для каждого дня недели — одна ячейка\n                    for (let i = 0; i < 6; i++) { const dateObj=new Date(currentTeacherWeek.getTime());\n                        dateObj.setDate(dateObj.getDate() + i); const dateStr=formatDate(dateObj); const\n                        cell=document.createElement('div'); cell.className='cell' ; const event=data.find(ev=>\n                        ev.date === dateStr &&\n                        ev.time === time\n                        );\n                \n                        if (event) {\n                        cell.classList.add('subject');\n                        if (event.type === \"Лабораторная\") cell.classList.add('purple');\n                        else if (event.type === \"Лекция\") cell.classList.add('green');\n                        else if (event.type === \"Практика\") cell.classList.add('blue');\n                        else if (event.type === \"Экзамен\") cell.classList.add('cyan');\n                \n                        cell.innerHTML = `\n                        <b>${event.name}</b><br>\n                        <span>${event.gruppa}</span><br>\n                        <span>${event.platform || event.room || ''}</span>\n                        ${event.conference ? `<br><a href=\"${event.conference}\">Перейти в конференцию</a>` : ''}\n                        `;\n                        }\n                \n                        row.appendChild(cell);\n                        }\n                \n                        table.appendChild(row);\n                        });\n                \n                        teacherScheduleTable.appendChild(table);\n                        }\n\n    function renderSchedule() {\n    updateYearLabel();\n\n    const teacherSelectorBlock = document.getElementById('teacherSelectorBlock');\n    if (isTeacher) {\n    teacherSelectorBlock.style.display = 'none';\n    } else {\n    teacherSelectorBlock.style.display = 'flex';\n    }\n    \n    const allTimes = [\n    \"08:00 - 09:35\",\n    \"09:45 - 11:20\",\n    \"11:30 - 13:05\",\n    \"13:30 - 15:05\",\n    \"15:15 - 16:50\"\n    ];\n    \n    fetch('http://localhost:1880/schedule')\n    .then(response => response.json())\n    .then(data => {\n    const scheduleContainer = document.querySelector('.info-rectangle');\n    scheduleContainer.innerHTML = ''; // Очищаем контейнер\n    \n    if (isTeacher) {\n    // Для преподавателя - получаем список всех преподавателей и отображаем их расписание\n    fetch('http://localhost:1880/tea')\n    .then(response => response.json())\n    .then(teachers => {\n    teachers.forEach(teacher => {\n    // Создаем контейнер для таблицы преподавателя\n    const teacherContainer = document.createElement('div');\n    teacherContainer.className = 'teacher-schedule-container';\n    \n    // Добавляем заголовок с именем преподавателя\n    const teacherHeader = document.createElement('h3');\n    teacherHeader.textContent = teacher;\n    teacherHeader.style.marginTop = '20px';\n    teacherHeader.style.marginBottom = '10px';\n    teacherContainer.appendChild(teacherHeader);\n    \n    // Создаем таблицу для этого преподавателя\n    const table = document.createElement('div');\n    table.className = 'table';\n    \n    // Создаем заголовок таблицы\n    const headerRow = document.createElement('div');\n    headerRow.className = 'row header-row';\n    headerRow.innerHTML = '<div class=\"cell time\">Время</div>';\n    \n    // Дни недели (6 штук)\n    const days = [];\n    const dayNames = [\"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\"];\n    for (let i = 0; i < 6; i++) { const date=new Date(currentMonday.getTime()); date.setDate(date.getDate() + i);\n        days.push(formatDate(date)); const headerCell=document.createElement('div'); headerCell.className='cell' ;\n        headerCell.innerHTML=`${dayNames[i]}<br>${formatDisplayDate(date)}`;\n        headerRow.appendChild(headerCell);\n        }\n    \n        table.appendChild(headerRow);\n    \n        // Для каждого временного слота — строка\n        allTimes.forEach(time => {\n        const row = document.createElement('div');\n        row.className = 'row';\n    \n        const timeCell = document.createElement('div');\n        timeCell.className = 'cell time';\n        timeCell.textContent = time;\n        row.appendChild(timeCell);\n    \n        // Для каждого дня недели — одна ячейка\n        for (let i = 0; i < 6; i++) { const dateObj=new Date(currentMonday.getTime()); dateObj.setDate(dateObj.getDate() +\n            i); const dateStr=formatDate(dateObj); const cell=document.createElement('div'); cell.className='cell' ; const\n            event=data.find(ev=>\n            ev.date === dateStr &&\n            ev.time === time &&\n            ev.teacher === teacher\n            );\n    \n            if (event) {\n            cell.classList.add('subject');\n            if (event.type === \"Лабораторная\") cell.classList.add('purple');\n            else if (event.type === \"Лекция\") cell.classList.add('green');\n            else if (event.type === \"Практика\") cell.classList.add('blue');\n            else if (event.type === \"Экзамен\") cell.classList.add('cyan');\n    \n            cell.innerHTML = `\n            <b>${event.name}</b><br>\n            <span>${event.gruppa}</span><br>\n            <span>${event.platform || event.room || ''}</span>\n            ${event.conference ? `<br><a href=\"${event.conference}\">Перейти в конференцию</a>` : ''}\n            `;\n            cell.setAttribute('data-subject', event.name);\n            cell.addEventListener('click', () => {\n            window.location.href = `subject?name=${encodeURIComponent(event.name)}`;\n            });\n            } else {\n            cell.style.position = 'relative';\n            const addButton = document.createElement('button');\n            addButton.textContent = '+';\n            addButton.className = 'add-button';\n            addButton.title = 'Добавить событие';\n            addButton.onclick = () => openAddModal(dateStr, time, teacher);\n            cell.appendChild(addButton);\n            }\n    \n            row.appendChild(cell);\n            }\n    \n            table.appendChild(row);\n            });\n    \n            teacherContainer.appendChild(table);\n            scheduleContainer.appendChild(teacherContainer);\n            });\n            });\n            } else {\n            // Для студента - обычное отображение\n            const table = document.createElement('div');\n            table.className = 'table';\n            table.id = 'scheduleTable';\n    \n            const headerRow = document.createElement('div');\n            headerRow.className = 'row header-row';\n            headerRow.innerHTML = '<div class=\"cell time\">Время</div>';\n    \n            // Дни недели (6 штук)\n            const days = [];\n            const dayNames = [\"Понедельник\", \"Вторник\", \"Среда\", \"Четверг\", \"Пятница\", \"Суббота\"];\n            for (let i = 0; i < 6; i++) { const date=new Date(currentMonday.getTime()); date.setDate(date.getDate() + i);\n                days.push(formatDate(date)); const headerCell=document.createElement('div'); headerCell.className='cell' ;\n                headerCell.innerHTML=`${dayNames[i]}<br>${formatDisplayDate(date)}`;\n                headerRow.appendChild(headerCell);\n                }\n    \n                table.appendChild(headerRow);\n    \n                // Для каждого временного слота — строка\n                allTimes.forEach(time => {\n                const row = document.createElement('div');\n                row.className = 'row';\n    \n                const timeCell = document.createElement('div');\n                timeCell.className = 'cell time';\n                timeCell.textContent = time;\n                row.appendChild(timeCell);\n    \n                // Для каждого дня недели — одна ячейка\n                for (let i = 0; i < 6; i++) { const dateObj=new Date(currentMonday.getTime());\n                    dateObj.setDate(dateObj.getDate() + i); const dateStr=formatDate(dateObj); const\n                    cell=document.createElement('div'); cell.className='cell' ; const event=data.find(ev=> ev.date ===\n                    dateStr && ev.time === time);\n                    if (event) {\n                    cell.classList.add('subject');\n                    if (event.type === \"Лабораторная\") cell.classList.add('purple');\n                    else if (event.type === \"Лекция\") cell.classList.add('green');\n                    else if (event.type === \"Практика\") cell.classList.add('blue');\n                    else if (event.type === \"Экзамен\") cell.classList.add('cyan');\n    \n                    cell.innerHTML = `\n                    <b>${event.name}</b><br>\n                    <span>${event.teacher}</span><br>\n                    <span>${event.platform || event.room || ''}</span>\n                    ${event.conference ? `<br><a href=\"${event.conference}\">Перейти в конференцию</a>` : ''}\n                    `;\n                    cell.setAttribute('data-subject', event.name);\n                    cell.addEventListener('click', () => {\n                    window.location.href = `subject?name=${encodeURIComponent(event.name)}`;\n                    });\n                    }\n    \n                    row.appendChild(cell);\n                    }\n    \n                    table.appendChild(row);\n                    });\n    \n                    scheduleContainer.appendChild(table);\n                    // Показываем контейнер выбора преподавателя только для студентов\n                    if (!isTeacher) {\n                        document.getElementById('teacherScheduleContainer').style.display = 'block';\n                        loadTeachersList();\n                    } else {\n                        document.getElementById('teacherScheduleContainer').style.display = 'none';\n                    }\n                    }\n                    })\n                    .catch(error => {\n                    console.error(\"Ошибка получения данных расписания:\", error);\n                    });\n    }\n\n    function openAddModal(date, time, teacher) {\n        const modal = document.getElementById('eventModal');\n        modal.style.display = 'block';\n        modal.setAttribute('data-date', date);\n        modal.setAttribute('data-time', time);\n        modal.setAttribute('data-teacher', teacher);\n        // Автозаполняем поле преподавателя\n        document.getElementById('eventTeacher').value = teacher;\n    }\n\n        function saveEvent() {\n        const gruppa = document.getElementById('eventGruppa').value.trim();\n        const name = document.getElementById('eventName').value.trim();\n        const teacher = document.getElementById('eventTeacher').value.trim();\n        const room = document.getElementById('eventRoom').value.trim();\n        const platform = document.getElementById('eventPlatform').value.trim();\n        const conference = document.getElementById('eventConference').value.trim();\n        const type = document.getElementById('eventType').value;\n        \n        const modal = document.getElementById('eventModal');\n        const date = modal.getAttribute('data-date');\n        const time = modal.getAttribute('data-time');\n        \n        if (!name || !teacher || !date || !time || !gruppa) {\n        alert(\"Пожалуйста, заполните все обязательные поля.\");\n        return;\n        }\n        \n        const newEvent = {\n        id: Math.floor(Date.now() / 1000),\n        gruppa: gruppa,\n        date: date,\n        time: time,\n        name: name,\n        teacher: teacher,\n        type: type,\n        room: room,\n        platform: platform,\n        conference: conference\n        };\n        \n        fetch('http://localhost:1880/schedule', {\n        method: 'POST',\n        headers: {\n        'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(newEvent)\n        })\n        .then(() => {\n        closeModal();\n        renderSchedule();\n        })\n        .catch(error => {\n        alert(\"Ошибка при сохранении события: \" + error.message);\n        });\n        }\n\n        document.addEventListener('DOMContentLoaded', function() {\n            renderSchedule();\n            if (!isTeacher) {\n                loadTeachersList();\n            }\n            // Инициализация выпадающего списка\n            const teacherSelector = document.getElementById('teacherSelector');\n            teacherSelector.onchange = function() {\n            if (!isTeacher) { // Обрабатываем выбор только для студентов\n            loadTeacherSchedule(this.value);\n            }\n            };\n        });\n    </script>\n\n</body>\n\n</html>",
        "output": "str",
        "x": 820,
        "y": 80,
        "wires": [
            [
                "68bfdecb21634892"
            ]
        ],
        "icon": "node-red/parser-html.svg"
    },
    {
        "id": "68bfdecb21634892",
        "type": "http response",
        "z": "b8ad15e59845239e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1050,
        "y": 80,
        "wires": []
    },
    {
        "id": "9b58ba8bc66a35cb",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "css",
        "func": "var css = `\nbody {\n            font-family: Arial, sans-serif;\n            margin: 0;\n            padding: 0;\n            height: 1200px;\n            background-color: #edf3fec1;\n        }\n\n        .topbar {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 80px;\n            background-color: #fff;\n            color: white;\n            display: flex;\n            align-items: center;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding-left: 20px;\n            z-index: 1;\n        }\n\n\n        .sidebar {\n            width: 45px;\n            height: 100%;\n            background-color: #fff;\n            color: white;\n            position: fixed;\n            top: 0;\n            left: 0;\n            transition: width 0.3s;\n            overflow: visible;\n            white-space: nowrap;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 10px;\n            z-index: 10;\n        }\n\n        .sidebar.expanded1 {\n            width: 340px;\n            transition: width 0.7s ease;\n        }\n\n        .sidebar:hover {\n            width: 340px;\n            transition: width 0.7s ease;\n        }\n\n        .toggle-btn {\n            cursor: pointer;\n            text-align: center;\n            padding: 10px;\n            background-color: #EDF3FE;\n            border: none;\n            color: white;\n            width: 33px;\n            height: 33px;\n            border-radius: 50%;\n            outline: none;\n            position: absolute;\n            left: 82%;\n            top: 40px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 10px;\n        }\n\n        .toggle-btn.expanded1 {\n            transform: rotate(180deg);\n        }\n\n        .toggle-btn img {\n            width: 100%;\n            height: 100%;\n            object-fit: contain;\n            display: block;\n            transition: transform 0.2s ease;\n        }\n\n        .button-list {\n            list-style-type: none;\n            padding: 0;\n            margin: 0;\n        }\n\n        .button-list li {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n        }\n\n        .button-list li img {\n            width: 24px;\n            height: 24px;\n            margin-right: 10px;\n        }\n\n        .button-list li:hover {\n            background-color: #555;\n        }\n\n        .text {\n            display: none;\n        }\n\n        .sidebar.expanded .text {\n            display: inline;\n        }\n\n        .sidebar:hover .text {\n            display: inline;\n        }\n\n        .logo {\n            width: 30px;\n            height: auto;\n            left: 84%;\n        }\n\n        .logo.small {\n            width: 300px;\n            height: auto;\n            transition: width 0.5s ease;\n        }\n\n        .logocenter {\n            border: 5px solid;\n            position: absolute;\n            top: 45px;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            padding: 10px;\n        }\n\n        .logocenter.small {\n            border: 6px solid;\n            position: absolute;\n            top: 110px;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            padding: 10px;\n        }\n\n        .logoname {\n            width: 230px;\n            height: auto;\n        }\n\n        .divlogoname {\n            height: auto;\n            position: absolute;\n            top: 20px;\n            left: 80px;\n            padding: 10px;\n        }\n\n        .menu {\n            list-style: none;\n            position: absolute;\n            color: black;\n            top: 60px;\n            width: 95%;\n            padding: 0;\n            margin: 40px 0 0 0;\n            transition: transform 0.7s ease;\n        }\n\n        .menu.small {\n            list-style: none;\n            position: absolute;\n            color: black;\n            top: 170px;\n            width: 95%;\n            padding: 0;\n            margin: 40px 0 0 0;\n        }\n\n        .menu li {\n            display: flex;\n            align-items: center;\n            padding: 12px;\n            cursor: pointer;\n            transition: background 0.6s;\n        }\n\n        .menu li:hover {\n            background: #EDF3FE;\n        }\n\n        .icon {\n            width: 24px;\n            height: 24px;\n            margin-right: 40px;\n        }\n\n        .text {\n            display: inline-block;\n            opacity: 0;\n            transition: opacity 0.3s ease 0.8s;\n            font-size: 18px;\n        }\n\n        .sidebar:not(.expanded1) .menu li,\n        .sidebar:hover:not(.expanded1) .menu li {\n            justify-content: left;\n        }\n\n        .sidebar:not(.expanded1) .text {\n            opacity: 0;\n            visibility: hidden;\n        }\n\n        .sidebar.expanded1 .menu li,\n        .sidebar:hover .menu li {\n\n            ustify-content: flex-start;\n            padding-left: 5px;\n        }\n\n        .sidebar.expanded1 .text,\n        .sidebar:hover .text {\n            opacity: 1;\n            visibility: visible;\n            transition-delay: 0.8s;\n        }\n\n        .main_content {\n            top: 105px;\n            position: relative;\n            color: black;\n            margin-top: 10px;\n            margin-left: 100px;\n            padding: 2px;\n            transition: margin-left 0.3s ease;\n        }\n\n        .sidebar.expanded1~.main_content {\n            margin-left: 400px;\n        }\n\n        .info-box {\n            text-align: center;\n        }\n\n        .info-label {\n            margin-bottom: 10px;\n            font-size: 18px;\n            font-weight: bold;\n        }\n\n        .info-rectangle {\n            width: 98%;\n            padding-right: -100px;\n            background-color: #fcfcfc;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            border-radius: 10px;\n        }\n\n        .table {\n            display: grid;\n            padding: 5px;\n            grid-template-columns: 6.5vw 1fr 1fr 1fr 1fr 1fr 1fr;\n            gap: 5px;\n        }\n\n        .row {\n            display: contents;\n        }\n\n        .cell {\n            background: white;\n            padding: 20px;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            min-height: 30px;\n            text-align: left;\n        }\n\n        .header-row .cell {\n            background: #EDF3FE;\n            font-weight: bold;\n            text-align: center;\n        }\n\n        .time {\n            font-weight: bold;\n            background: #EDF3FE;\n            padding: 20px;\n        }\n\n        .subject a {\n            color: blue;\n            text-decoration: none;\n        }\n\n        .subject {\n            cursor: pointer;\n            background-color: #fff;\n            font-size: 14px;\n            line-height: 1.4;\n            transition: background-color 0.3s;\n        }\n\n        .subject:hover {\n            background-color: #dee7f9c8\n        }\n\n        .green {\n            border-left: 5px solid green;\n        }\n\n        .blue {\n            border-left: 5px solid rgb(0, 68, 255);\n        }\n\n        .purple {\n            border-left: 5px solid purple;\n        }\n\n        .cyan {\n            border-left: 5px solid rgb(17, 4, 90);\n        }\n\n        .info-subject {\n            margin-bottom: 10px;\n            font-size: 30px;\n            font-weight: bold;\n        }\n\n        .task_info_table {\n            display: grid;\n            padding: 6px;\n            grid-template-columns: 1fr 3fr;\n            gap: 5px;\n        }\n\n        .task_state {\n            min-height: 150px;\n            min-width: 200px;\n            background: #EDF3FE;\n            padding: 20px;\n            transition: all 0.3s ease;\n        }\n\n        .task_table {\n            display: grid;\n            min-width: 360px;\n            background: #EDF3FE;\n            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;\n            gap: 5px;\n        }\n\n        @media (max-width: 2300px) {\n            .task_table {\n                grid-template-columns: 1fr 1fr 1fr 1fr;\n            }\n        }\n\n        @media (max-width: 1500px) {\n            .task_table {\n                grid-template-columns: 1fr 1fr 1fr;\n            }\n\n            .task_state {\n                min-width: 300px;\n            }\n        }\n\n        @media (max-width: 1000px) {\n            .task_table {\n                grid-template-columns: 1fr 1fr;\n            }\n        }\n\n        @media (max-width: 900px) {\n            .task_table {\n                grid-template-columns: 1fr;\n                min-width: 200px;\n            }\n        }\n\n        @media (max-width: 810px) {\n            .task_info_table {\n                grid-template-columns: 1fr;\n            }\n        }\n\n        .task {\n            background: white;\n            padding: 20px;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            min-height: 50px;\n            text-align: left;\n        }\n\n        .teacher-card {\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 20px;\n            max-width: 500px;\n            margin: 0 auto;\n        }\n\n        .teacher-title {\n            font-size: 18px;\n            font-weight: bold;\n            text-align: left;\n            margin: 0 0 15px 0;\n            padding-left: 10px;\n        }\n\n        .teacher-info {\n            display: flex;\n            align-items: center;\n            justify-content: flex-start;\n        }\n\n        .teacher-photo {\n            width: 100px;\n            height: 100px;\n            border-radius: 50%;\n            object-fit: cover;\n            margin-right: 20px;\n        }\n\n        .teacher-details {\n            flex: 1;\n            text-align: left;\n        }\n\n        .teacher-details p {\n            margin: 5px 0;\n        }\n\n        .msg-button {\n            margin-top: 10px;\n            background-color: #0017e2;\n            color: white;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 14px;\n        }\n\n        .msg-button:hover {\n            background-color: #3054b8;\n        }\n\n        .hidden {\n            display: none;\n        }\n\n        .lab-details {\n            background: white;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n            padding: 20px;\n            max-width: 500px;\n            margin: 0 auto;\n        }\n\n        .lab-comment {\n            padding: 20px;\n        }\n\n        .task-status {\n            font-size: 14px;\n            color: #f00;\n            /* или другой цвет */\n            margin-top: 8px;\n        }\n\n        /* Новый блок с заданием */\n        .assignment-details {\n            margin-top: 20px;\n        }\n\n        .assignment-details .info-rectangle {\n            background: #EDF3FE;\n            border-radius: 10px;\n            padding: 20px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n        }\n\n        /* Прогресс-бар (если не добавлены ранее) */\n        .progress-container {\n            background-color: #f3f3f3;\n            border-radius: 8px;\n            height: 10px;\n            width: 100%;\n            overflow: hidden;\n            margin-top: 10px;\n        }\n\n        .progress-bar {\n            height: 100%;\n            background-color: #4caf50;\n            transition: width 1s ease;\n        }\n\n        .add-button {\n            position: absolute;\n            right: 5px;\n            bottom: 5px;\n            width: 24px;\n            height: 24px;\n            border: none;\n            border-radius: 50%;\n            background-color: #edf3fe;\n            color: #000;\n            font-weight: bold;\n            cursor: pointer;\n            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n            display: none;\n        }\n\n        .cell:hover .add-button {\n            display: block;\n        }\n\n        .modal {\n            display: none;\n            position: fixed;\n            top: 20%;\n            left: 50%;\n            transform: translateX(-50%);\n            background: white;\n            padding: 20px;\n            z-index: 100;\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n            border-radius: 10px;\n        }\n        .teacher-schedule-container {\n            margin-bottom: 40px;\n            border: 1px solid #ddd;\n            border-radius: 10px;\n            padding: 15px;\n            background-color: white;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n        }   \n\n        .teacher-schedule-container h3 {\n            color: #333;\n            padding-bottom: 10px;\n            border-bottom: 1px solid #eee;\n            margin-top: 0;\n        }\n        .teacherScheduleContainer {\n            margin-top: 30px;\n            padding: 20px;\n            background-color: white;\n            border-radius: 10px;\n            box-shadow: 0 4px 8px rgba(215, 225, 238, 0.736);\n        }\n\n        .teacherSelector {\n            padding: 8px 12px;\n            border-radius: 5px;\n            border: 1px solid #ddd;\n            background-color: #f9f9f9;\n            font-size: 14px;\n            min-width: 250px;\n        }\n        #teacherWeekNavigation button {\n            padding: 5px 10px;\n            border: 1px solid #ddd;\n            border-radius: 5px;\n            background-color: #f9f9f9;\n            cursor: pointer;\n            font-size: 14px;\n        }\n\n        #teacherWeekNavigation button:hover {\n            background-color: #EDF3FE;\n        }\n\n        #teacherWeekNavigation {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        #teacherWeekLabel {\n            font-weight: bold;\n            min-width: 150px;\n            text-align: center;\n        }\n`;\n\nmsg.cssText = css;\nmsg.userRole = msg.userRole;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 160,
        "wires": [
            [
                "8269f2a4a554d9e6"
            ]
        ]
    },
    {
        "id": "6ed544fd13ce011c",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "Проверка авторизации",
        "func": "// Проверяем куки\nif (!msg.req.cookies || !msg.req.cookies.auth_token) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\n// Получаем ID пользователя из куки\nconst userId = msg.req.cookies.user_id;\nif (!userId) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\nmsg.topic = `SELECT role FROM users WHERE id = '${userId}'`;\nmsg.userId = userId;\n\n// Здесь можно добавить проверку валидности токена\n// Например, сравнить с хранящимся в памяти или БД\n\nreturn [msg, null];",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 80,
        "wires": [
            [
                "c867954ffcc849d8"
            ],
            [
                "68bfdecb21634892"
            ]
        ]
    },
    {
        "id": "e97ea9fdecc739c4",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "получение роли",
        "func": "// Проверяем, что получили роль пользователя\nif (!msg.payload || msg.payload.length === 0) {\n    node.error(\"Не удалось получить роль пользователя\", msg);\n    return [null, msg];\n}\n\nconst userRole = msg.payload[0].role;\nmsg.userRole = userRole; // Сохраняем роль в сообщении\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 160,
        "wires": [
            [
                "9b58ba8bc66a35cb"
            ]
        ]
    },
    {
        "id": "c867954ffcc849d8",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "select * from events",
        "name": "SQLite DB",
        "x": 250,
        "y": 160,
        "wires": [
            [
                "e97ea9fdecc739c4"
            ]
        ]
    },
    {
        "id": "0736f6e8124b7f73",
        "type": "http in",
        "z": "b8ad15e59845239e",
        "name": "",
        "url": "/schedule",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 440,
        "wires": [
            [
                "849f5fa1eb8e8aed"
            ]
        ]
    },
    {
        "id": "6b8cc300ad5f3b1b",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "Расписание",
        "func": "msg.payload = {\n  \"events\": [\n    {\n      \"id\": 1,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-20\",\n      \"time\": \"09:45 - 11:20\",\n      \"name\": \"Системы искусственного интеллекта\",\n      \"teacher\": \"Солдатова Ольга Петровна\",\n      \"type\": \"Лабораторная\",\n      \"room\": \"507-14\",\n      \"platform\": \"\",\n      \"conference\": \"\"\n    },\n    {\n      \"id\": 2,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-21\",\n      \"time\": \"11:30 - 13:05\",\n      \"name\": \"Системное программирование\",\n      \"teacher\": \"Привалов Александр Юрьевич\",\n      \"type\": \"Лабораторная\",\n      \"room\": \"407-14\",\n      \"platform\": \"\",\n      \"conference\": \"\"\n    },\n    {\n      \"id\": 3,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-19\",\n      \"time\": \"08:00 - 09:35\",\n      \"name\": \"Системы искусственного интеллекта\",\n      \"teacher\": \"Солдатова Ольга Петровна\",\n      \"type\": \"Лабораторная\",\n      \"room\": \"507-14\",\n      \"platform\": \"\",\n      \"conference\": \"\"\n    },\n    {\n      \"id\": 4,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-19\",\n      \"time\": \"09:45 - 11:20\",\n      \"name\": \"Технологии проектирования информационно-вычислительных систем\",\n      \"teacher\": \"Мезенцева Екатерина Михайловна\",\n      \"type\": \"Лекция\",\n      \"room\": \"\",\n      \"platform\": \"online\",\n      \"conference\": \"https://conference.example.com\"\n    },\n    {\n      \"id\": 5,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-23\",\n      \"time\": \"09:45 - 11:20\",\n      \"name\": \"Использование Linux\",\n      \"teacher\": \"Кузьмишина Татьяна Михайловна\",\n      \"type\": \"Лабораторная\",\n      \"room\": \"510-14\",\n      \"platform\": \"\",\n      \"conference\": \"\"\n    },\n    {\n      \"id\": 6,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-19\",\n      \"time\": \"11:30 - 13:05\",\n      \"name\": \"Технологии проектирования информационно-вычислительных систем\",\n      \"teacher\": \"Мезенцева Екатерина Михайловна\",\n      \"type\": \"Лекция\",\n      \"room\": \"\",\n      \"platform\": \"online\",\n      \"conference\": \"https://conference.example.com\"\n    },\n    {\n      \"id\": 7,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-22\",\n      \"time\": \"11:30 - 13:05\",\n      \"name\": \"ИТ-практикум\",\n      \"teacher\": \"Сопченко Елена Вильевна\",\n      \"type\": \"Практика\",\n      \"room\": \"519-14\",\n      \"platform\": \"\",\n      \"conference\": \"\"\n    },\n    {\n      \"id\": 8,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-23\",\n      \"time\": \"11:30 - 13:05\",\n      \"name\": \"Использование Linux\",\n      \"teacher\": \"Кузьмишина Татьяна Михайловна\",\n      \"type\": \"Лабораторная\",\n      \"room\": \"510-14\",\n      \"platform\": \"\",\n      \"conference\": \"\"\n    },\n    {\n      \"id\": 9,\n      \"group\": \"21ВВВ1\",\n      \"date\": \"2025-05-23\",\n      \"time\": \"15:15 - 16:50\",\n      \"name\": \"ИТ-практикум\",\n      \"teacher\": \"Сопченко Елена Вильевна\",\n      \"type\": \"Практика\",\n      \"room\": \"519-14\",\n      \"platform\": \"\",\n      \"conference\": \"\"\n    },\n  ]\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 600,
        "wires": [
            []
        ],
        "icon": "font-awesome/fa-calendar"
    },
    {
        "id": "f656923fe1ced9d7",
        "type": "http response",
        "z": "b8ad15e59845239e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1350,
        "y": 440,
        "wires": []
    },
    {
        "id": "16f6f1771e99ae89",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "select * from events",
        "name": "SQLite DB",
        "x": 1130,
        "y": 440,
        "wires": [
            [
                "f656923fe1ced9d7"
            ]
        ]
    },
    {
        "id": "58ceb1ee01b7663c",
        "type": "http in",
        "z": "b8ad15e59845239e",
        "name": "",
        "url": "/schedule",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 500,
        "wires": [
            [
                "1b7deb88e5838c73"
            ]
        ]
    },
    {
        "id": "1b7deb88e5838c73",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "ввод данных",
        "func": "const insertSql = `INSERT INTO events (gruppa, date, time, name, teacher, type, room, platform, conference) VALUES ('${msg.payload.gruppa}', '${msg.payload.date}', '${msg.payload.time}', '${msg.payload.name}', '${msg.payload.teacher}', '${msg.payload.type}', '${msg.payload.room}', '${msg.payload.platform}', '${msg.payload.conference}')`;\nmsg.topic = insertSql;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 500,
        "wires": [
            [
                "db04d53f3b01977b"
            ]
        ]
    },
    {
        "id": "db04d53f3b01977b",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 620,
        "y": 500,
        "wires": [
            [
                "e6966d3e7e2cdf53"
            ]
        ]
    },
    {
        "id": "e6966d3e7e2cdf53",
        "type": "http response",
        "z": "b8ad15e59845239e",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 840,
        "y": 500,
        "wires": []
    },
    {
        "id": "849f5fa1eb8e8aed",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "получение группы",
        "func": "// Получаем ID пользователя из куки\nconst userId = msg.req.cookies.user_id;\nif (!userId) {\n    msg.headers = {\n        \"Location\": \"/login\"\n    };\n    msg.statusCode = 302;\n    return [null, msg];\n}\n\nmsg.userId = userId;\n\n// Получаем группу пользователя из БД\nconst getUserGroupQuery = `SELECT gruppa FROM users WHERE id = ${msg.userId}`;\nmsg.topic = getUserGroupQuery;\n\n// Сохраняем оригинальное сообщение для следующего шага\nmsg.originalPayload = msg.payload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 440,
        "wires": [
            [
                "33c56e361b0c5488"
            ]
        ]
    },
    {
        "id": "33c56e361b0c5488",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 620,
        "y": 440,
        "wires": [
            [
                "34294c39cdd16708"
            ]
        ]
    },
    {
        "id": "34294c39cdd16708",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "получение расписания",
        "func": "// Проверяем, что получили группу пользователя\nif (!msg.payload || msg.payload.length === 0) {\n    node.error(\"Не удалось получить группу пользователя\", msg);\n    return null;\n}\n\nconst userGroup = msg.payload[0].gruppa;\n\n// Формируем запрос для получения расписания только для этой группы\nif (userGroup === \"teacher\") {\n    msg.topic = `SELECT * FROM events`;\n} else {\n    msg.topic = `SELECT * FROM events WHERE gruppa = '${userGroup}'`;\n}\n\n// Восстанавливаем оригинальное сообщение\nmsg.payload = msg.originalPayload;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 440,
        "wires": [
            [
                "16f6f1771e99ae89"
            ]
        ]
    },
    {
        "id": "7f16958aef058167",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "Преподаватели по предметам",
        "func": "const subjectName = msg.req.params.subject_name;\n\nswitch (subjectName) {\n    case \"Системы искусственного интеллекта\":\n        msg.payload = {\n            \"name\": \"Солдатова Ольга Петровна\",\n            \"email\": \"soldatova.op@ssau.ru\",\n            \"photo\": \"http://cabinet.ssau.ru/assets/staff_photo/soldatova_o_p.jpg\"\n        };\n        break;\n    case \"Технологии проектирования информационно-вычислительных систем\":\n        msg.payload = {\n            \"name\": \"Мезенцева Екатерина Михайловна\",\n            \"email\": \"mezenceva.em@ssau.ru\",\n            \"photo\": \"https://cabinet.ssau.ru/storage/photos/photo-813397191-63386c803b2e7.jpg\"\n        };\n        break;\n    case \"Системное программирование\":\n        msg.payload = {\n            \"name\": \"Привалов Александр Юрьевич\",\n            \"email\": \"privalov.ayu@ssau.ru\",\n            \"photo\": null\n        };\n        break;\n}\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 80,
        "wires": [
            [
                "9c027dd27a1cc616"
            ]
        ],
        "icon": "font-awesome/fa-user-circle-o"
    },
    {
        "id": "a029268e80a98e77",
        "type": "http in",
        "z": "b8ad15e59845239e",
        "name": "",
        "url": "/teacher:subject_name",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 1360,
        "y": 80,
        "wires": [
            [
                "7f16958aef058167"
            ]
        ]
    },
    {
        "id": "9c027dd27a1cc616",
        "type": "http response",
        "z": "b8ad15e59845239e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1890,
        "y": 80,
        "wires": []
    },
    {
        "id": "ef7a5da9587957db",
        "type": "inject",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Инициализация БД",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 550,
        "y": 600,
        "wires": [
            [
                "0ad1669754d81440"
            ]
        ]
    },
    {
        "id": "0ad1669754d81440",
        "type": "function",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Создать таблицу events",
        "func": "// Создаем таблицу пользователей, если она не существует\nconst sql = `CREATE TABLE IF NOT EXISTS events (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    gruppa TEXT NOT NULL,\n    date TEXT NOT NULL,\n    time TEXT NOT NULL,\n    name TEXT NOT NULL,\n    teacher TEXT NOT NULL,\n    type TEXT NOT NULL,\n    room TEXT,\n    platform TEXT,\n    conference TEXT\n)`;\n\nmsg.topic = sql;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 600,
        "wires": [
            [
                "c670a2a0e1a147cd"
            ]
        ]
    },
    {
        "id": "c670a2a0e1a147cd",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "mydb": "d3f44785a6cfb327",
        "sql": "",
        "name": "SQLite DB",
        "x": 1050,
        "y": 600,
        "wires": [
            [
                "506a261d3026523f"
            ]
        ]
    },
    {
        "id": "506a261d3026523f",
        "type": "debug",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 600,
        "wires": []
    },
    {
        "id": "4435b9b11e8bb8df",
        "type": "inject",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Вывод таблиц БД",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SELECT name FROM sqlite_master WHERE type='table';",
        "x": 550,
        "y": 660,
        "wires": [
            [
                "c0f3b2afb792826c"
            ]
        ]
    },
    {
        "id": "521a5e7271fcb269",
        "type": "debug",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 660,
        "wires": []
    },
    {
        "id": "c0f3b2afb792826c",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "SQLite DB",
        "x": 790,
        "y": 660,
        "wires": [
            [
                "521a5e7271fcb269"
            ]
        ]
    },
    {
        "id": "0a156d769dc90c6e",
        "type": "inject",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Вывод событий",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 540,
        "y": 720,
        "wires": [
            [
                "e830fc36391e8aca"
            ]
        ]
    },
    {
        "id": "86716a0157a63135",
        "type": "debug",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "все события",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 720,
        "wires": []
    },
    {
        "id": "e830fc36391e8aca",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "fixed",
        "sql": "select * from events",
        "name": "SQLite DB",
        "x": 790,
        "y": 720,
        "wires": [
            [
                "86716a0157a63135"
            ]
        ]
    },
    {
        "id": "f90b46636f0f5855",
        "type": "inject",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Создание события",
        "props": [
            {
                "p": "msg.payload.gruppa",
                "v": "21ВВВ1",
                "vt": "str"
            },
            {
                "p": "msg.payload.date",
                "v": "2025-05-20",
                "vt": "str"
            },
            {
                "p": "msg.payload.time",
                "v": "09:45 - 11:20",
                "vt": "str"
            },
            {
                "p": "msg.payload.name",
                "v": "Системы искусственного интеллекта",
                "vt": "str"
            },
            {
                "p": "msg.payload.teacher",
                "v": "Солдатова Ольга Петровна",
                "vt": "str"
            },
            {
                "p": "msg.payload.type",
                "v": "Лабораторная",
                "vt": "str"
            },
            {
                "p": "msg.payload.room",
                "v": "507-14",
                "vt": "str"
            },
            {
                "p": "msg.payload.platform",
                "v": "",
                "vt": "str"
            },
            {
                "p": "msg.payload.conference",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "x": 550,
        "y": 780,
        "wires": [
            [
                "d07dc257cc2e7b34"
            ]
        ]
    },
    {
        "id": "d07dc257cc2e7b34",
        "type": "function",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "ввод данных",
        "func": "const insertSql = `INSERT INTO events (id, gruppa, date, time, name, teacher, type, room, platform, conference) VALUES ('${msg.payload.id}', '${msg.payload.gruppa}', '${msg.payload.date}', '${msg.payload.time}', '${msg.payload.name}', '${msg.payload.teacher}', '${msg.payload.type}', '${msg.payload.room}', '${msg.payload.platform}', '${msg.payload.conference}')`;\nmsg.topic = insertSql;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 780,
        "wires": [
            [
                "ade0f032a5d1969d"
            ]
        ]
    },
    {
        "id": "ade0f032a5d1969d",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 1070,
        "y": 780,
        "wires": [
            [
                "30f9663de217782b"
            ]
        ]
    },
    {
        "id": "30f9663de217782b",
        "type": "debug",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1290,
        "y": 780,
        "wires": []
    },
    {
        "id": "cbaffe357d4b92cc",
        "type": "inject",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Удалить из БД",
        "props": [
            {
                "p": "topic.date",
                "v": "2025-05-20",
                "vt": "str"
            },
            {
                "p": "topic.time",
                "v": "09:45 - 11:20",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 540,
        "y": 840,
        "wires": [
            [
                "4d9fdba8846ce6c9"
            ]
        ]
    },
    {
        "id": "4d9fdba8846ce6c9",
        "type": "function",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Команда",
        "func": "if (msg.topic == \"all\") {\n    msg.topic = \"DELETE FROM events\";\n}\nelse if (msg.topic){//удалить по id\n    msg.topic = `DELETE FROM events WHERE date = '${msg.topic.date}' AND time = '${msg.topic.time}'`;\n}\nelse {\n    msg.topic = \"SELECT 'msg.topic пуст' AS text\";\n}\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 840,
        "wires": [
            [
                "5d7b2b3a65369fd3"
            ]
        ]
    },
    {
        "id": "7b8d6d98e2cc821c",
        "type": "debug",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1290,
        "y": 840,
        "wires": []
    },
    {
        "id": "5d7b2b3a65369fd3",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 1070,
        "y": 840,
        "wires": [
            [
                "7b8d6d98e2cc821c"
            ]
        ]
    },
    {
        "id": "45113b6952cab182",
        "type": "function",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Команда",
        "func": "const insertSql = `SELECT * FROM events WHERE date = '${msg.payload.date}' AND time = '${msg.payload.time}'`;\nmsg.topic = insertSql;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 900,
        "wires": [
            [
                "d2ce509bad35943e"
            ]
        ]
    },
    {
        "id": "191d03ab4cc2074e",
        "type": "debug",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "mes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1290,
        "y": 900,
        "wires": []
    },
    {
        "id": "d2ce509bad35943e",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "DELETE FROM hourly_stats",
        "name": "",
        "x": 1070,
        "y": 900,
        "wires": [
            [
                "191d03ab4cc2074e"
            ]
        ]
    },
    {
        "id": "caf2fa8abd83d2c3",
        "type": "inject",
        "z": "b8ad15e59845239e",
        "g": "6cebdc9467483554",
        "name": "Найти событие",
        "props": [
            {
                "p": "msg.payload.date",
                "v": "2025-05-20",
                "vt": "str"
            },
            {
                "p": "msg.payload.time",
                "v": "09:45 - 11:20",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "1",
        "topic": "",
        "x": 540,
        "y": 900,
        "wires": [
            [
                "45113b6952cab182"
            ]
        ]
    },
    {
        "id": "f60db2fec6f5a72c",
        "type": "http in",
        "z": "b8ad15e59845239e",
        "name": "",
        "url": "/tea",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 240,
        "wires": [
            [
                "7ea8cd8ae0ba711a"
            ]
        ]
    },
    {
        "id": "1d2b986854c67369",
        "type": "http in",
        "z": "b8ad15e59845239e",
        "name": "",
        "url": "/tea_schedule",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 190,
        "y": 320,
        "wires": [
            [
                "2f2f637812191cbe"
            ]
        ]
    },
    {
        "id": "2f2f637812191cbe",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "учителя",
        "func": "// В узле Function для /teacher_schedule\nconst teacher = msg.req.query.teacher;\nconst startDate = msg.req.query.start;\nconst endDate = msg.req.query.end;\n\nif (!teacher) {\n    msg.statusCode = 400;\n    msg.payload = { error: \"Teacher name is required\" };\n    return [null, msg];\n}\n\nmsg.topic = `SELECT * FROM events WHERE teacher = '${teacher}' \n             AND date BETWEEN '${startDate}' AND '${endDate}'\n             ORDER BY date, time`;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 320,
        "wires": [
            [
                "42e932ac55e2234b"
            ]
        ]
    },
    {
        "id": "42e932ac55e2234b",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "msg.topic",
        "sql": "SELECT name FROM sqlite_master WHERE type='table';",
        "name": "",
        "x": 640,
        "y": 320,
        "wires": [
            [
                "43a513127624f529"
            ]
        ]
    },
    {
        "id": "a49e79c9273fc373",
        "type": "http response",
        "z": "b8ad15e59845239e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 990,
        "y": 240,
        "wires": []
    },
    {
        "id": "43a513127624f529",
        "type": "http response",
        "z": "b8ad15e59845239e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 870,
        "y": 320,
        "wires": []
    },
    {
        "id": "2870a94edebb6e2e",
        "type": "debug",
        "z": "b8ad15e59845239e",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 280,
        "wires": []
    },
    {
        "id": "9640050dbd577582",
        "type": "function",
        "z": "b8ad15e59845239e",
        "name": "учителя",
        "func": "// Узел \"Format Teachers Response\"\nif (!msg.payload || !Array.isArray(msg.payload)) {\n    msg.payload = [];\n} else {\n    // Преобразуем в массив строк\n    msg.payload = msg.payload.map(item => item.name);\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 240,
        "wires": [
            [
                "a49e79c9273fc373"
            ]
        ]
    },
    {
        "id": "7ea8cd8ae0ba711a",
        "type": "sqlite",
        "z": "b8ad15e59845239e",
        "mydb": "d3f44785a6cfb327",
        "sqlquery": "fixed",
        "sql": "SELECT DISTINCT teacher as name FROM events WHERE teacher IS NOT NULL AND teacher != '';",
        "name": "SQLite DB",
        "x": 610,
        "y": 240,
        "wires": [
            [
                "9640050dbd577582"
            ]
        ]
    }
]